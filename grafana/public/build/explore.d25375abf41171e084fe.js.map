{"version":3,"sources":["webpack:///./public/app/containers/Explore/Legend.tsx","webpack:///./public/app/containers/Explore/Graph.tsx","webpack:///./public/app/containers/Explore/utils/dom.ts","webpack:///./public/app/containers/Explore/slate-plugins/prism/index.tsx","webpack:///./public/app/containers/Explore/slate-plugins/prism/promql.ts","webpack:///./public/app/containers/Explore/slate-plugins/braces.ts","webpack:///./public/app/containers/Explore/utils/prometheus.ts","webpack:///./public/app/containers/Explore/Typeahead.tsx","webpack:///./public/app/containers/Explore/QueryField.tsx","webpack:///./public/app/containers/Explore/slate-plugins/clear.ts","webpack:///./public/app/containers/Explore/slate-plugins/newline.ts","webpack:///./public/app/containers/Explore/PromQueryField.tsx","webpack:///./public/app/containers/Explore/slate-plugins/runner.ts","webpack:///./public/app/containers/Explore/QueryRows.tsx","webpack:///./public/app/containers/Explore/utils/query.ts","webpack:///./public/app/containers/Explore/TimePicker.tsx","webpack:///./public/app/containers/Explore/Table.tsx","webpack:///./public/app/containers/Explore/Logs.tsx","webpack:///./public/app/containers/Explore/ElapsedTime.tsx","webpack:///./public/app/containers/Explore/Explore.tsx","webpack:///./public/app/containers/Explore/Wrapper.tsx"],"names":["LegendItem","_a","series","react_default","a","createElement","className","style","color","alias","_super","Legend","tslib_es6","prototype","render","this","props","_b","items","data","map","key","id","react","FLOT_OPTIONS","legend","show","lines","linewidth","zero","shadowSize","grid","minBorderMargin","markings","backgroundColor","borderWidth","clickable","margin","left","right","labelMarginX","Graph_Graph","Graph","componentDidMount","draw","componentDidUpdate","prevProps","options","split","height","userOptions","$el","jquery_js_exposed_default","ts","label","getFlotPairs","ticks","width","range","from","to","moment_default","isMoment","datemath","min","valueOf","max","dynamicOptions","xaxis","mode","timeformat","secPerTick","time_format","plot","empty","loading","length","Explore_Legend","__webpack_exports__","getNextCharacter","global","window","selection","getSelection","anchorNode","getRangeAt","text","textContent","offset","startOffset","substr","Element","closest","s","i","matches","document","ownerDocument","querySelectorAll","el","item","parentElement","TOKEN_MARK","FUNCTIONS","insertText","documentation","concat","detail","promql","comment","pattern","lookbehind","context-aggregation","inside","label-key","context-labels","label-value","greedy","function","RegExp","f","join","context-range","range-duration","number","operator","punctuation","BRACES","[","{","(","NON_SELECTOR_SPACE_REGEXP","RATE_RANGES","prometheus_cleanText","replace","trim","selectorRegexp","labelRegexp","parseSelector","query","cursorOffset","match","selector","labelKeys","Error","prefix","slice","prefixOpen","lastIndexOf","prefixClose","suffix","suffixClose","indexOf","suffixOpenIndex","suffixOpen","labels","delimiterIndex","value","metricMatch","Object","keys","sort","Typeahead_TypeaheadItem","TypeaheadItem","_this","apply","arguments","getRef","onClick","onClickItem","isSelected","offsetParent","container","offsetTop","scrollTop","offsetHeight","scrollIntoView","ref","PureComponent","Typeahead_TypeaheadGroup","TypeaheadGroup","selected","Explore_Typeahead","Typeahead","groupedItems","menuRef","selectedItem","g","TYPEAHEAD_DEBOUNCE","flattenSuggestions","reduce","acc","makeFragment","line","slate_es","create","type","nodes","getInitialValue","QueryField_QueryField","QueryField","context","call","onChange","changed","state","setState","handleChangeValue","requestAnimationFrame","handleTypeahead","onValueChanged","slate_plain_serializer_es","serialize","lodash_default","debounce","cleanText","onTypeahead","wrapperNode","editorNode","isBlurred","prefix_1","suggestions","refresher_1","refresher","filteredSuggestions","group","skipFilter","filter","c","filterText","prefixMatch","skipSort","sortBy","sortText","typeaheadPrefix","typeaheadContext","typeaheadText","then","catch","e","console","error","onKeyDown","event","change","typeaheadIndex","menuEl","preventDefault","stopPropagation","resetTypeahead","ctrlKey","flattenedSuggestions","suggestion","Math","abs","applyTypeahead","handleBlur","onBlur","resetTimer","setTimeout","handleFocus","onFocus","onClickMenu","updateMenu","menu","node","rect_1","getBoundingClientRect","scrollX_1","scrollX","scrollY_1","scrollY","opacity","top","removeAttribute","renderMenu","portalPrefix","selectedIndex","QueryField_Portal","plugins","isCollapsed","anchorText","anchorOffset","forward","deleteForward","shiftKey","indent","trimLeft","getIndent","startBlock","splitBlock","focus","additionalPlugins","initialValue","componentWillUnmount","clearTimeout","componentWillReceiveProps","nextProps","onWillApplySuggestion","suggestionText","move","backward","deleteBackwards","suffixLength","fragment","deleteBackward","insertFragment","slate_react_es","autoCorrect","placeholder","spellCheck","Component","Portal","index","classList","add","body","appendChild","removeChild","react_dom_default","createPortal","children","Explore_QueryField","DEFAULT_KEYS","HISTOGRAM_GROUP","HISTORY_COUNT_CUTOFF","METRIC_MARK","PRISM_LANGUAGE","RECORDING_RULES_GROUP","wrapLabel","setFunctionMove","willApplySuggestion","nextChar","startsWith","Explore_PromQueryField","PromQueryField","onChangeMetrics","values","selectedOptions","metric","onChangeQuery","override","onQueryChange","onClickHintFix","hint","fix","action","onReceiveMetrics","metrics","language","field","prism_default","languages","setPrismTokens","typeahead","wrapperClasses","Array","labelKeyNode","sibling","previousSibling","querySelector","getPreviousCousin","labelKey","result","getTypeahead","log","request","url","fetch","search","handler","RunnerPlugin","onPressEnter","definition","renderMark","mark","get","decorateNode","texts","getTexts","toArray","tstring","t","grammar","tokens","tokenize","decorations","startText","shift","endText","endOffset","start","processToken","token","types","content","newlines","end","available","remaining","anchorKey","focusKey","focusOffset","marks","push","_i","tokens_1","PrismPlugin","histogramMetrics","labelValues","metricsByPrefix","fetchMetricNames","fetchHistogramMetrics","includes","getRangeTypeahead","getLabelTypeahead","getAggregationTypeahead","getEmptyTypeahead","history","historyItems","chain","uniqBy","take","h","cutoffTs","Date","now","historyForItem","count","recent","fromNow","addHistoryMetadata","anchorBlock","getText","leftSide","openParensAggregationIndex","openParensSelectorIndex","closeParensSelectorIndex","selectorString","fetchSeriesLabels","parsedSelector","containsMetric","existingKeys","possibleKeys","difference","Promise","all","fetchLabelValues","histogramSeries","res","_c","sent","json","exisingValues","e_1","name","withName","callback","_d","forEach","l","__name__","rest","processLabels","e_2","delimiter","ruleRegex","ruleNames","test","rulesOption","metricsOptions","groupBy","metricsForPrefix","m","groupMetricsByPrefix","error_1","histogramOptions","hm","es","initialQuery","QueryRows_QueryRow","QueryRow","onClickAddButton","onAddQueryRow","onClickClearButton","onClickRemoveButton","onRemoveQueryRow","onExecuteQuery","edited","queryError","queryHint","QueryRows_QueryRows","QueryRows","queries","queryErrors","queryHints","handlers","q","generateQueryKey","random","ensureQueries","hasQuery","some","DATE_FORMAT","DEFAULT_RANGE","parseTime","isUtc","asString","isNaN","epoch","parseInt","moment__WEBPACK_IMPORTED_MODULE_2___default","utc","format","TimePicker","handleChangeFrom","fromRaw","target","handleChangeTo","toRaw","handleClickApply","onChangeTime","app_core_utils_datemath__WEBPACK_IMPORTED_MODULE_3__","rangeString","app_core_utils_rangeutil__WEBPACK_IMPORTED_MODULE_4__","isOpen","handleClickLeft","handleClickPicker","handleClickRight","handleClickRefresh","handleClickRelativeOption","dropdownRef","dropdownEl","refreshInterval","tslib__WEBPACK_IMPORTED_MODULE_0__","direction","timespan","getTimeOptions","renderDropdown","timeOptions","react__WEBPACK_IMPORTED_MODULE_1___default","section","option","active","display","react__WEBPACK_IMPORTED_MODULE_1__","EMPTY_TABLE","Cell","columnIndex","rowIndex","table","onClickCell","column","columns","filterable","Table","tableModel","rows","col","row","j","String","Entry","entry","searchMatches","lastMatchEnd_1","spans","Fragment","title","Logs","hasData","logLevel","timestamp","timeFromNow","timeLocal","ElapsedTime","elapsed","tick","timer","setInterval","time","clearInterval","toFixed","Explore","nextQueries","_utils_query__WEBPACK_IMPORTED_MODULE_16__","onChangeDatasource","datasource","datasourceError","datasourceLoading","graphResult","latency","logsResult","tableResult","datasourceSrv","setDatasource","prevQuery","nextQuery","onSubmit","undefined","nextRange","onClickClear","onClickCloseSplit","onChangeSplit","onClickGraphButton","showingGraph","onClickLogsButton","showingLogs","onClickSplit","onClickTableButton","showingTable","onClickTableCell","columnKey","rowValue","onModifyQueries","modifyQuery","supportsGraph","supportsLogs","supportsTable","runTableQuery","runGraphQuery","runLogsQuery","metadataRequest","initialState","initial","parsed","JSON","parse","app_core_utils_location_util__WEBPACK_IMPORTED_MODULE_8__","_TimePicker__WEBPACK_IMPORTED_MODULE_15__","parseUrlState","routeParams","datasourceMissing","initialDatasource","requestOptions","datasources","getExploreSources","meta","explore","componentDidCatch","logs","datasourceId","testDatasource","testResult","status","message","statusText","historyKey","app_core_store__WEBPACK_IMPORTED_MODULE_6__","getObject","init","onQuerySuccess","setObject","buildQueryOptions","targetOptions","resolution","offsetWidth","absoluteRange","app_core_utils_datemath__WEBPACK_IMPORTED_MODULE_9__","interval","app_core_utils_kbn__WEBPACK_IMPORTED_MODULE_4__","calculateInterval","targets","expr","instant","hinting","dataList","seriesData","datapoints","colorIndex","app_core_utils_colors__WEBPACK_IMPORTED_MODULE_5__","app_core_time_series2__WEBPACK_IMPORTED_MODULE_7__","unit","makeTimeSeriesList","hints","hintsByIndex","makeHints","response_1","response_2","logsData","response_3","position","showingBoth","graphHeight","graphButtonActive","logsButtonActive","tableButtonActive","exploreClass","ds","selectedDatasource","react_select__WEBPACK_IMPORTED_MODULE_3__","clearable","_ElapsedTime__WEBPACK_IMPORTED_MODULE_10__","_QueryRows__WEBPACK_IMPORTED_MODULE_11__","_Graph__WEBPACK_IMPORTED_MODULE_12__","_Table__WEBPACK_IMPORTED_MODULE_14__","_Logs__WEBPACK_IMPORTED_MODULE_13__","react_hot_loader__WEBPACK_IMPORTED_MODULE_2__","module","Wrapper","handleChangeSplit","_Explore__WEBPACK_IMPORTED_MODULE_2__"],"mappings":"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","file":"explore.d25375abf41171e084fe.js","sourcesContent":["import React, { PureComponent } from 'react';\r\n\r\nconst LegendItem = ({ series }) => (\r\n  <div className=\"graph-legend-series\">\r\n    <div className=\"graph-legend-icon\">\r\n      <i className=\"fa fa-minus pointer\" style={{ color: series.color }} />\r\n    </div>\r\n    <a className=\"graph-legend-alias pointer\">{series.alias}</a>\r\n  </div>\r\n);\r\n\r\nexport default class Legend extends PureComponent<any, any> {\r\n  render() {\r\n    const { className = '', data } = this.props;\r\n    const items = data || [];\r\n    return (\r\n      <div className={`${className} graph-legend ps`}>\r\n        {items.map(series => <LegendItem key={series.id} series={series} />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import $ from 'jquery';\r\nimport React, { Component } from 'react';\r\nimport moment from 'moment';\r\n\r\nimport 'vendor/flot/jquery.flot';\r\nimport 'vendor/flot/jquery.flot.time';\r\nimport * as dateMath from 'app/core/utils/datemath';\r\nimport TimeSeries from 'app/core/time_series2';\r\n\r\nimport Legend from './Legend';\r\n\r\n// Copied from graph.ts\r\nfunction time_format(ticks, min, max) {\r\n  if (min && max && ticks) {\r\n    const range = max - min;\r\n    const secPerTick = range / ticks / 1000;\r\n    const oneDay = 86400000;\r\n    const oneYear = 31536000000;\r\n\r\n    if (secPerTick <= 45) {\r\n      return '%H:%M:%S';\r\n    }\r\n    if (secPerTick <= 7200 || range <= oneDay) {\r\n      return '%H:%M';\r\n    }\r\n    if (secPerTick <= 80000) {\r\n      return '%m/%d %H:%M';\r\n    }\r\n    if (secPerTick <= 2419200 || range <= oneYear) {\r\n      return '%m/%d';\r\n    }\r\n    return '%Y-%m';\r\n  }\r\n\r\n  return '%H:%M';\r\n}\r\n\r\nconst FLOT_OPTIONS = {\r\n  legend: {\r\n    show: false,\r\n  },\r\n  series: {\r\n    lines: {\r\n      linewidth: 1,\r\n      zero: false,\r\n    },\r\n    shadowSize: 0,\r\n  },\r\n  grid: {\r\n    minBorderMargin: 0,\r\n    markings: [],\r\n    backgroundColor: null,\r\n    borderWidth: 0,\r\n    // hoverable: true,\r\n    clickable: true,\r\n    color: '#a1a1a1',\r\n    margin: { left: 0, right: 0 },\r\n    labelMarginX: 0,\r\n  },\r\n  // selection: {\r\n  //   mode: 'x',\r\n  //   color: '#666',\r\n  // },\r\n  // crosshair: {\r\n  //   mode: 'x',\r\n  // },\r\n};\r\n\r\nclass Graph extends Component<any, any> {\r\n  componentDidMount() {\r\n    this.draw();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (\r\n      prevProps.data !== this.props.data ||\r\n      prevProps.options !== this.props.options ||\r\n      prevProps.split !== this.props.split ||\r\n      prevProps.height !== this.props.height\r\n    ) {\r\n      this.draw();\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    const { data, options: userOptions } = this.props;\r\n    const $el = $(`#${this.props.id}`);\r\n    if (!data) {\r\n      $el.empty();\r\n      return;\r\n    }\r\n    const series = data.map((ts: TimeSeries) => ({\r\n      color: ts.color,\r\n      label: ts.label,\r\n      data: ts.getFlotPairs('null'),\r\n    }));\r\n\r\n    const ticks = $el.width() / 100;\r\n    let { from, to } = userOptions.range;\r\n    if (!moment.isMoment(from)) {\r\n      from = dateMath.parse(from, false);\r\n    }\r\n    if (!moment.isMoment(to)) {\r\n      to = dateMath.parse(to, true);\r\n    }\r\n    const min = from.valueOf();\r\n    const max = to.valueOf();\r\n    const dynamicOptions = {\r\n      xaxis: {\r\n        mode: 'time',\r\n        min: min,\r\n        max: max,\r\n        label: 'Datetime',\r\n        ticks: ticks,\r\n        timeformat: time_format(ticks, min, max),\r\n      },\r\n    };\r\n    const options = {\r\n      ...FLOT_OPTIONS,\r\n      ...dynamicOptions,\r\n      ...userOptions,\r\n    };\r\n    $.plot($el, series, options);\r\n  }\r\n\r\n  render() {\r\n    const { data, height, loading } = this.props;\r\n    if (!loading && data && data.length === 0) {\r\n      return (\r\n        <div className=\"panel-container\">\r\n          <div className=\"muted m-a-1\">The queries returned no time series to graph.</div>\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"panel-container\">\r\n        <div id={this.props.id} className=\"explore-graph\" style={{ height }} />\r\n        <Legend data={data} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Graph;\r\n","// Node.closest() polyfill\r\nif ('Element' in window && !Element.prototype.closest) {\r\n  Element.prototype.closest = function(this: any, s) {\r\n    const matches = (this.document || this.ownerDocument).querySelectorAll(s);\r\n    let el = this;\r\n    let i;\r\n    // eslint-disable-next-line\r\n    do {\r\n      i = matches.length;\r\n      // eslint-disable-next-line\r\n      while (--i >= 0 && matches.item(i) !== el) {}\r\n    } while (i < 0 && (el = el.parentElement));\r\n    return el;\r\n  };\r\n}\r\n\r\nexport function getPreviousCousin(node, selector) {\r\n  let sibling = node.parentElement.previousSibling;\r\n  let el;\r\n  while (sibling) {\r\n    el = sibling.querySelector(selector);\r\n    if (el) {\r\n      return el;\r\n    }\r\n    sibling = sibling.previousSibling;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function getNextCharacter(global = window) {\r\n  const selection = global.getSelection();\r\n  if (!selection.anchorNode) {\r\n    return null;\r\n  }\r\n\r\n  const range = selection.getRangeAt(0);\r\n  const text = selection.anchorNode.textContent;\r\n  const offset = range.startOffset;\r\n  return text.substr(offset, 1);\r\n}\r\n","import React from 'react';\r\nimport Prism from 'prismjs';\r\n\r\nconst TOKEN_MARK = 'prism-token';\r\n\r\nexport function setPrismTokens(language, field, values, alias = 'variable') {\r\n  Prism.languages[language][field] = {\r\n    alias,\r\n    pattern: new RegExp(`(?:^|\\\\s)(${values.join('|')})(?:$|\\\\s)`),\r\n  };\r\n}\r\n\r\n/**\r\n * Code-highlighting plugin based on Prism and\r\n * https://github.com/ianstormtaylor/slate/blob/master/examples/code-highlighting/index.js\r\n *\r\n * (Adapted to handle nested grammar definitions.)\r\n */\r\n\r\nexport default function PrismPlugin({ definition, language }) {\r\n  if (definition) {\r\n    // Don't override exising modified definitions\r\n    Prism.languages[language] = Prism.languages[language] || definition;\r\n  }\r\n\r\n  return {\r\n    /**\r\n     * Render a Slate mark with appropiate CSS class names\r\n     *\r\n     * @param {Object} props\r\n     * @return {Element}\r\n     */\r\n\r\n    renderMark(props) {\r\n      const { children, mark } = props;\r\n      // Only apply spans to marks identified by this plugin\r\n      if (mark.type !== TOKEN_MARK) {\r\n        return undefined;\r\n      }\r\n      const className = `token ${mark.data.get('types')}`;\r\n      return <span className={className}>{children}</span>;\r\n    },\r\n\r\n    /**\r\n     * Decorate code blocks with Prism.js highlighting.\r\n     *\r\n     * @param {Node} node\r\n     * @return {Array}\r\n     */\r\n\r\n    decorateNode(node) {\r\n      if (node.type !== 'paragraph') {\r\n        return [];\r\n      }\r\n\r\n      const texts = node.getTexts().toArray();\r\n      const tstring = texts.map(t => t.text).join('\\n');\r\n      const grammar = Prism.languages[language];\r\n      const tokens = Prism.tokenize(tstring, grammar);\r\n      const decorations = [];\r\n      let startText = texts.shift();\r\n      let endText = startText;\r\n      let startOffset = 0;\r\n      let endOffset = 0;\r\n      let start = 0;\r\n\r\n      function processToken(token, acc?) {\r\n        // Accumulate token types down the tree\r\n        const types = `${acc || ''} ${token.type || ''} ${token.alias || ''}`;\r\n\r\n        // Add mark for token node\r\n        if (typeof token === 'string' || typeof token.content === 'string') {\r\n          startText = endText;\r\n          startOffset = endOffset;\r\n\r\n          const content = typeof token === 'string' ? token : token.content;\r\n          const newlines = content.split('\\n').length - 1;\r\n          const length = content.length - newlines;\r\n          const end = start + length;\r\n\r\n          let available = startText.text.length - startOffset;\r\n          let remaining = length;\r\n\r\n          endOffset = startOffset + remaining;\r\n\r\n          while (available < remaining) {\r\n            endText = texts.shift();\r\n            remaining = length - available;\r\n            available = endText.text.length;\r\n            endOffset = remaining;\r\n          }\r\n\r\n          // Inject marks from up the tree (acc) as well\r\n          if (typeof token !== 'string' || acc) {\r\n            const range = {\r\n              anchorKey: startText.key,\r\n              anchorOffset: startOffset,\r\n              focusKey: endText.key,\r\n              focusOffset: endOffset,\r\n              marks: [{ type: TOKEN_MARK, data: { types } }],\r\n            };\r\n\r\n            decorations.push(range);\r\n          }\r\n\r\n          start = end;\r\n        } else if (token.content && token.content.length) {\r\n          // Tokens can be nested\r\n          for (const subToken of token.content) {\r\n            processToken(subToken, types);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Process top-level tokens\r\n      for (const token of tokens) {\r\n        processToken(token);\r\n      }\r\n\r\n      return decorations;\r\n    },\r\n  };\r\n}\r\n","/* tslint:disable max-line-length */\r\n\r\nexport const OPERATORS = ['by', 'group_left', 'group_right', 'ignoring', 'on', 'offset', 'without'];\r\n\r\nconst AGGREGATION_OPERATORS = [\r\n  {\r\n    label: 'sum',\r\n    insertText: 'sum()',\r\n    documentation: 'Calculate sum over dimensions',\r\n  },\r\n  {\r\n    label: 'min',\r\n    insertText: 'min()',\r\n    documentation: 'Select minimum over dimensions',\r\n  },\r\n  {\r\n    label: 'max',\r\n    insertText: 'max()',\r\n    documentation: 'Select maximum over dimensions',\r\n  },\r\n  {\r\n    label: 'avg',\r\n    insertText: 'avg()',\r\n    documentation: 'Calculate the average over dimensions',\r\n  },\r\n  {\r\n    label: 'stddev',\r\n    insertText: 'stddev()',\r\n    documentation: 'Calculate population standard deviation over dimensions',\r\n  },\r\n  {\r\n    label: 'stdvar',\r\n    insertText: 'stdvar()',\r\n    documentation: 'Calculate population standard variance over dimensions',\r\n  },\r\n  {\r\n    label: 'count',\r\n    insertText: 'count()',\r\n    documentation: 'Count number of elements in the vector',\r\n  },\r\n  {\r\n    label: 'count_values',\r\n    insertText: 'count_values()',\r\n    documentation: 'Count number of elements with the same value',\r\n  },\r\n  {\r\n    label: 'bottomk',\r\n    insertText: 'bottomk()',\r\n    documentation: 'Smallest k elements by sample value',\r\n  },\r\n  {\r\n    label: 'topk',\r\n    insertText: 'topk()',\r\n    documentation: 'Largest k elements by sample value',\r\n  },\r\n  {\r\n    label: 'quantile',\r\n    insertText: 'quantile()',\r\n    documentation: 'Calculate -quantile (0    1) over dimensions',\r\n  },\r\n];\r\n\r\nexport const FUNCTIONS = [\r\n  ...AGGREGATION_OPERATORS,\r\n  {\r\n    insertText: 'abs()',\r\n    label: 'abs',\r\n    detail: 'abs(v instant-vector)',\r\n    documentation: 'Returns the input vector with all sample values converted to their absolute value.',\r\n  },\r\n  {\r\n    insertText: 'absent()',\r\n    label: 'absent',\r\n    detail: 'absent(v instant-vector)',\r\n    documentation:\r\n      'Returns an empty vector if the vector passed to it has any elements and a 1-element vector with the value 1 if the vector passed to it has no elements. This is useful for alerting on when no time series exist for a given metric name and label combination.',\r\n  },\r\n  {\r\n    insertText: 'ceil()',\r\n    label: 'ceil',\r\n    detail: 'ceil(v instant-vector)',\r\n    documentation: 'Rounds the sample values of all elements in `v` up to the nearest integer.',\r\n  },\r\n  {\r\n    insertText: 'changes()',\r\n    label: 'changes',\r\n    detail: 'changes(v range-vector)',\r\n    documentation:\r\n      'For each input time series, `changes(v range-vector)` returns the number of times its value has changed within the provided time range as an instant vector.',\r\n  },\r\n  {\r\n    insertText: 'clamp_max()',\r\n    label: 'clamp_max',\r\n    detail: 'clamp_max(v instant-vector, max scalar)',\r\n    documentation: 'Clamps the sample values of all elements in `v` to have an upper limit of `max`.',\r\n  },\r\n  {\r\n    insertText: 'clamp_min()',\r\n    label: 'clamp_min',\r\n    detail: 'clamp_min(v instant-vector, min scalar)',\r\n    documentation: 'Clamps the sample values of all elements in `v` to have a lower limit of `min`.',\r\n  },\r\n  {\r\n    insertText: 'count_scalar()',\r\n    label: 'count_scalar',\r\n    detail: 'count_scalar(v instant-vector)',\r\n    documentation:\r\n      'Returns the number of elements in a time series vector as a scalar. This is in contrast to the `count()` aggregation operator, which always returns a vector (an empty one if the input vector is empty) and allows grouping by labels via a `by` clause.',\r\n  },\r\n  {\r\n    insertText: 'day_of_month()',\r\n    label: 'day_of_month',\r\n    detail: 'day_of_month(v=vector(time()) instant-vector)',\r\n    documentation: 'Returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31.',\r\n  },\r\n  {\r\n    insertText: 'day_of_week()',\r\n    label: 'day_of_week',\r\n    detail: 'day_of_week(v=vector(time()) instant-vector)',\r\n    documentation:\r\n      'Returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc.',\r\n  },\r\n  {\r\n    insertText: 'days_in_month()',\r\n    label: 'days_in_month',\r\n    detail: 'days_in_month(v=vector(time()) instant-vector)',\r\n    documentation:\r\n      'Returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31.',\r\n  },\r\n  {\r\n    insertText: 'delta()',\r\n    label: 'delta',\r\n    detail: 'delta(v range-vector)',\r\n    documentation:\r\n      'Calculates the difference between the first and last value of each time series element in a range vector `v`, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers.',\r\n  },\r\n  {\r\n    insertText: 'deriv()',\r\n    label: 'deriv',\r\n    detail: 'deriv(v range-vector)',\r\n    documentation:\r\n      'Calculates the per-second derivative of the time series in a range vector `v`, using simple linear regression.',\r\n  },\r\n  {\r\n    insertText: 'drop_common_labels()',\r\n    label: 'drop_common_labels',\r\n    detail: 'drop_common_labels(instant-vector)',\r\n    documentation: 'Drops all labels that have the same name and value across all series in the input vector.',\r\n  },\r\n  {\r\n    insertText: 'exp()',\r\n    label: 'exp',\r\n    detail: 'exp(v instant-vector)',\r\n    documentation:\r\n      'Calculates the exponential function for all elements in `v`.\\nSpecial cases are:\\n* `Exp(+Inf) = +Inf` \\n* `Exp(NaN) = NaN`',\r\n  },\r\n  {\r\n    insertText: 'floor()',\r\n    label: 'floor',\r\n    detail: 'floor(v instant-vector)',\r\n    documentation: 'Rounds the sample values of all elements in `v` down to the nearest integer.',\r\n  },\r\n  {\r\n    insertText: 'histogram_quantile()',\r\n    label: 'histogram_quantile',\r\n    detail: 'histogram_quantile( float, b instant-vector)',\r\n    documentation:\r\n      'Calculates the -quantile (0    1) from the buckets `b` of a histogram. The samples in `b` are the counts of observations in each bucket. Each sample must have a label `le` where the label value denotes the inclusive upper bound of the bucket. (Samples without such a label are silently ignored.) The histogram metric type automatically provides time series with the `_bucket` suffix and the appropriate labels.',\r\n  },\r\n  {\r\n    insertText: 'holt_winters()',\r\n    label: 'holt_winters',\r\n    detail: 'holt_winters(v range-vector, sf scalar, tf scalar)',\r\n    documentation:\r\n      'Produces a smoothed value for time series based on the range in `v`. The lower the smoothing factor `sf`, the more importance is given to old data. The higher the trend factor `tf`, the more trends in the data is considered. Both `sf` and `tf` must be between 0 and 1.',\r\n  },\r\n  {\r\n    insertText: 'hour()',\r\n    label: 'hour',\r\n    detail: 'hour(v=vector(time()) instant-vector)',\r\n    documentation: 'Returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23.',\r\n  },\r\n  {\r\n    insertText: 'idelta()',\r\n    label: 'idelta',\r\n    detail: 'idelta(v range-vector)',\r\n    documentation:\r\n      'Calculates the difference between the last two samples in the range vector `v`, returning an instant vector with the given deltas and equivalent labels.',\r\n  },\r\n  {\r\n    insertText: 'increase()',\r\n    label: 'increase',\r\n    detail: 'increase(v range-vector)',\r\n    documentation:\r\n      'Calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments.',\r\n  },\r\n  {\r\n    insertText: 'irate()',\r\n    label: 'irate',\r\n    detail: 'irate(v range-vector)',\r\n    documentation:\r\n      'Calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for.',\r\n  },\r\n  {\r\n    insertText: 'label_replace()',\r\n    label: 'label_replace',\r\n    detail: 'label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)',\r\n    documentation:\r\n      \"For each timeseries in `v`, `label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`  matches the regular expression `regex` against the label `src_label`.  If it matches, then the timeseries is returned with the label `dst_label` replaced by the expansion of `replacement`. `$1` is replaced with the first matching subgroup, `$2` with the second etc. If the regular expression doesn't match then the timeseries is returned unchanged.\",\r\n  },\r\n  {\r\n    insertText: 'ln()',\r\n    label: 'ln',\r\n    detail: 'ln(v instant-vector)',\r\n    documentation:\r\n      'calculates the natural logarithm for all elements in `v`.\\nSpecial cases are:\\n * `ln(+Inf) = +Inf`\\n * `ln(0) = -Inf`\\n * `ln(x < 0) = NaN`\\n * `ln(NaN) = NaN`',\r\n  },\r\n  {\r\n    insertText: 'log2()',\r\n    label: 'log2',\r\n    detail: 'log2(v instant-vector)',\r\n    documentation:\r\n      'Calculates the binary logarithm for all elements in `v`. The special cases are equivalent to those in `ln`.',\r\n  },\r\n  {\r\n    insertText: 'log10()',\r\n    label: 'log10',\r\n    detail: 'log10(v instant-vector)',\r\n    documentation:\r\n      'Calculates the decimal logarithm for all elements in `v`. The special cases are equivalent to those in `ln`.',\r\n  },\r\n  {\r\n    insertText: 'minute()',\r\n    label: 'minute',\r\n    detail: 'minute(v=vector(time()) instant-vector)',\r\n    documentation:\r\n      'Returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59.',\r\n  },\r\n  {\r\n    insertText: 'month()',\r\n    label: 'month',\r\n    detail: 'month(v=vector(time()) instant-vector)',\r\n    documentation:\r\n      'Returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc.',\r\n  },\r\n  {\r\n    insertText: 'predict_linear()',\r\n    label: 'predict_linear',\r\n    detail: 'predict_linear(v range-vector, t scalar)',\r\n    documentation:\r\n      'Predicts the value of time series `t` seconds from now, based on the range vector `v`, using simple linear regression.',\r\n  },\r\n  {\r\n    insertText: 'rate()',\r\n    label: 'rate',\r\n    detail: 'rate(v range-vector)',\r\n    documentation:\r\n      \"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period.\",\r\n  },\r\n  {\r\n    insertText: 'resets()',\r\n    label: 'resets',\r\n    detail: 'resets(v range-vector)',\r\n    documentation:\r\n      'For each input time series, `resets(v range-vector)` returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset.',\r\n  },\r\n  {\r\n    insertText: 'round()',\r\n    label: 'round',\r\n    detail: 'round(v instant-vector, to_nearest=1 scalar)',\r\n    documentation:\r\n      'Rounds the sample values of all elements in `v` to the nearest integer. Ties are resolved by rounding up. The optional `to_nearest` argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction.',\r\n  },\r\n  {\r\n    insertText: 'scalar()',\r\n    label: 'scalar',\r\n    detail: 'scalar(v instant-vector)',\r\n    documentation:\r\n      'Given a single-element input vector, `scalar(v instant-vector)` returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, `scalar` will return `NaN`.',\r\n  },\r\n  {\r\n    insertText: 'sort()',\r\n    label: 'sort',\r\n    detail: 'sort(v instant-vector)',\r\n    documentation: 'Returns vector elements sorted by their sample values, in ascending order.',\r\n  },\r\n  {\r\n    insertText: 'sort_desc()',\r\n    label: 'sort_desc',\r\n    detail: 'sort_desc(v instant-vector)',\r\n    documentation: 'Returns vector elements sorted by their sample values, in descending order.',\r\n  },\r\n  {\r\n    insertText: 'sqrt()',\r\n    label: 'sqrt',\r\n    detail: 'sqrt(v instant-vector)',\r\n    documentation: 'Calculates the square root of all elements in `v`.',\r\n  },\r\n  {\r\n    insertText: 'time()',\r\n    label: 'time',\r\n    detail: 'time()',\r\n    documentation:\r\n      'Returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated.',\r\n  },\r\n  {\r\n    insertText: 'vector()',\r\n    label: 'vector',\r\n    detail: 'vector(s scalar)',\r\n    documentation: 'Returns the scalar `s` as a vector with no labels.',\r\n  },\r\n  {\r\n    insertText: 'year()',\r\n    label: 'year',\r\n    detail: 'year(v=vector(time()) instant-vector)',\r\n    documentation: 'Returns the year for each of the given times in UTC.',\r\n  },\r\n  {\r\n    insertText: 'avg_over_time()',\r\n    label: 'avg_over_time',\r\n    detail: 'avg_over_time(range-vector)',\r\n    documentation: 'The average value of all points in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'min_over_time()',\r\n    label: 'min_over_time',\r\n    detail: 'min_over_time(range-vector)',\r\n    documentation: 'The minimum value of all points in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'max_over_time()',\r\n    label: 'max_over_time',\r\n    detail: 'max_over_time(range-vector)',\r\n    documentation: 'The maximum value of all points in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'sum_over_time()',\r\n    label: 'sum_over_time',\r\n    detail: 'sum_over_time(range-vector)',\r\n    documentation: 'The sum of all values in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'count_over_time()',\r\n    label: 'count_over_time',\r\n    detail: 'count_over_time(range-vector)',\r\n    documentation: 'The count of all values in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'quantile_over_time()',\r\n    label: 'quantile_over_time',\r\n    detail: 'quantile_over_time(scalar, range-vector)',\r\n    documentation: 'The -quantile (0    1) of the values in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'stddev_over_time()',\r\n    label: 'stddev_over_time',\r\n    detail: 'stddev_over_time(range-vector)',\r\n    documentation: 'The population standard deviation of the values in the specified interval.',\r\n  },\r\n  {\r\n    insertText: 'stdvar_over_time()',\r\n    label: 'stdvar_over_time',\r\n    detail: 'stdvar_over_time(range-vector)',\r\n    documentation: 'The population standard variance of the values in the specified interval.',\r\n  },\r\n];\r\n\r\nconst tokenizer = {\r\n  comment: {\r\n    pattern: /(^|[^\\n])#.*/,\r\n    lookbehind: true,\r\n  },\r\n  'context-aggregation': {\r\n    pattern: /((by|without)\\s*)\\([^)]*\\)/, // by ()\r\n    lookbehind: true,\r\n    inside: {\r\n      'label-key': {\r\n        pattern: /[^,\\s][^,]*[^,\\s]*/,\r\n        alias: 'attr-name',\r\n      },\r\n    },\r\n  },\r\n  'context-labels': {\r\n    pattern: /\\{[^}]*(?=})/,\r\n    inside: {\r\n      'label-key': {\r\n        pattern: /[a-z_]\\w*(?=\\s*(=|!=|=~|!~))/,\r\n        alias: 'attr-name',\r\n      },\r\n      'label-value': {\r\n        pattern: /\"(?:\\\\.|[^\\\\\"])*\"/,\r\n        greedy: true,\r\n        alias: 'attr-value',\r\n      },\r\n    },\r\n  },\r\n  function: new RegExp(`\\\\b(?:${FUNCTIONS.map(f => f.label).join('|')})(?=\\\\s*\\\\()`, 'i'),\r\n  'context-range': [\r\n    {\r\n      pattern: /\\[[^\\]]*(?=])/, // [1m]\r\n      inside: {\r\n        'range-duration': {\r\n          pattern: /\\b\\d+[smhdwy]\\b/i,\r\n          alias: 'number',\r\n        },\r\n      },\r\n    },\r\n    {\r\n      pattern: /(offset\\s+)\\w+/, // offset 1m\r\n      lookbehind: true,\r\n      inside: {\r\n        'range-duration': {\r\n          pattern: /\\b\\d+[smhdwy]\\b/i,\r\n          alias: 'number',\r\n        },\r\n      },\r\n    },\r\n  ],\r\n  number: /\\b-?\\d+((\\.\\d*)?([eE][+-]?\\d+)?)?\\b/,\r\n  operator: new RegExp(`/[-+*/=%^~]|&&?|\\\\|?\\\\||!=?|<(?:=>?|<|>)?|>[>=]?|\\\\b(?:${OPERATORS.join('|')})\\\\b`, 'i'),\r\n  punctuation: /[{};()`,.]/,\r\n};\r\n\r\nexport default tokenizer;\r\n","const BRACES = {\r\n  '[': ']',\r\n  '{': '}',\r\n  '(': ')',\r\n};\r\n\r\nconst NON_SELECTOR_SPACE_REGEXP = / (?![^}]+})/;\r\n\r\nexport default function BracesPlugin() {\r\n  return {\r\n    onKeyDown(event, change) {\r\n      const { value } = change;\r\n      if (!value.isCollapsed) {\r\n        return undefined;\r\n      }\r\n\r\n      switch (event.key) {\r\n        case '{':\r\n        case '[': {\r\n          event.preventDefault();\r\n          // Insert matching braces\r\n          change\r\n            .insertText(`${event.key}${BRACES[event.key]}`)\r\n            .move(-1)\r\n            .focus();\r\n          return true;\r\n        }\r\n\r\n        case '(': {\r\n          event.preventDefault();\r\n          const text = value.anchorText.text;\r\n          const offset = value.anchorOffset;\r\n          const delimiterIndex = text.slice(offset).search(NON_SELECTOR_SPACE_REGEXP);\r\n          const length = delimiterIndex > -1 ? delimiterIndex + offset : text.length;\r\n          const forward = length - offset;\r\n          // Insert matching braces\r\n          change\r\n            .insertText(event.key)\r\n            .move(forward)\r\n            .insertText(BRACES[event.key])\r\n            .move(-1 - forward)\r\n            .focus();\r\n          return true;\r\n        }\r\n\r\n        default: {\r\n          break;\r\n        }\r\n      }\r\n      return undefined;\r\n    },\r\n  };\r\n}\r\n","export const RATE_RANGES = ['1m', '5m', '10m', '30m', '1h'];\r\n\r\nexport function processLabels(labels, withName = false) {\r\n  const values = {};\r\n  labels.forEach(l => {\r\n    const { __name__, ...rest } = l;\r\n    if (withName) {\r\n      values['__name__'] = values['__name__'] || [];\r\n      if (values['__name__'].indexOf(__name__) === -1) {\r\n        values['__name__'].push(__name__);\r\n      }\r\n    }\r\n\r\n    Object.keys(rest).forEach(key => {\r\n      if (!values[key]) {\r\n        values[key] = [];\r\n      }\r\n      if (values[key].indexOf(rest[key]) === -1) {\r\n        values[key].push(rest[key]);\r\n      }\r\n    });\r\n  });\r\n  return { values, keys: Object.keys(values) };\r\n}\r\n\r\n// Strip syntax chars\r\nexport const cleanText = s => s.replace(/[{}[\\]=\"(),!~+\\-*/^%]/g, '').trim();\r\n\r\n// const cleanSelectorRegexp = /\\{(\\w+=\"[^\"\\n]*?\")(,\\w+=\"[^\"\\n]*?\")*\\}/;\r\nconst selectorRegexp = /\\{[^}]*?\\}/;\r\nconst labelRegexp = /\\b\\w+=\"[^\"\\n]*?\"/g;\r\nexport function parseSelector(query: string, cursorOffset = 1): { labelKeys: any[]; selector: string } {\r\n  if (!query.match(selectorRegexp)) {\r\n    // Special matcher for metrics\r\n    if (query.match(/^\\w+$/)) {\r\n      return {\r\n        selector: `{__name__=\"${query}\"}`,\r\n        labelKeys: ['__name__'],\r\n      };\r\n    }\r\n    throw new Error('Query must contain a selector: ' + query);\r\n  }\r\n\r\n  // Check if inside a selector\r\n  const prefix = query.slice(0, cursorOffset);\r\n  const prefixOpen = prefix.lastIndexOf('{');\r\n  const prefixClose = prefix.lastIndexOf('}');\r\n  if (prefixOpen === -1) {\r\n    throw new Error('Not inside selector, missing open brace: ' + prefix);\r\n  }\r\n  if (prefixClose > -1 && prefixClose > prefixOpen) {\r\n    throw new Error('Not inside selector, previous selector already closed: ' + prefix);\r\n  }\r\n  const suffix = query.slice(cursorOffset);\r\n  const suffixCloseIndex = suffix.indexOf('}');\r\n  const suffixClose = suffixCloseIndex + cursorOffset;\r\n  const suffixOpenIndex = suffix.indexOf('{');\r\n  const suffixOpen = suffixOpenIndex + cursorOffset;\r\n  if (suffixClose === -1) {\r\n    throw new Error('Not inside selector, missing closing brace in suffix: ' + suffix);\r\n  }\r\n  if (suffixOpenIndex > -1 && suffixOpen < suffixClose) {\r\n    throw new Error('Not inside selector, next selector opens before this one closed: ' + suffix);\r\n  }\r\n\r\n  // Extract clean labels to form clean selector, incomplete labels are dropped\r\n  const selector = query.slice(prefixOpen, suffixClose);\r\n  const labels = {};\r\n  selector.replace(labelRegexp, match => {\r\n    const delimiterIndex = match.indexOf('=');\r\n    const key = match.slice(0, delimiterIndex);\r\n    const value = match.slice(delimiterIndex + 1, match.length);\r\n    labels[key] = value;\r\n    return '';\r\n  });\r\n\r\n  // Add metric if there is one before the selector\r\n  const metricPrefix = query.slice(0, prefixOpen);\r\n  const metricMatch = metricPrefix.match(/\\w+$/);\r\n  if (metricMatch) {\r\n    labels['__name__'] = `\"${metricMatch[0]}\"`;\r\n  }\r\n\r\n  // Build sorted selector\r\n  const labelKeys = Object.keys(labels).sort();\r\n  const cleanSelector = labelKeys.map(key => `${key}=${labels[key]}`).join(',');\r\n\r\n  const selectorString = ['{', cleanSelector, '}'].join('');\r\n\r\n  return { labelKeys, selector: selectorString };\r\n}\r\n","import React from 'react';\r\n\r\nimport { Suggestion, SuggestionGroup } from './QueryField';\r\n\r\nfunction scrollIntoView(el: HTMLElement) {\r\n  if (!el || !el.offsetParent) {\r\n    return;\r\n  }\r\n  const container = el.offsetParent as HTMLElement;\r\n  if (el.offsetTop > container.scrollTop + container.offsetHeight || el.offsetTop < container.scrollTop) {\r\n    container.scrollTop = el.offsetTop - container.offsetTop;\r\n  }\r\n}\r\n\r\ninterface TypeaheadItemProps {\r\n  isSelected: boolean;\r\n  item: Suggestion;\r\n  onClickItem: (Suggestion) => void;\r\n}\r\n\r\nclass TypeaheadItem extends React.PureComponent<TypeaheadItemProps, {}> {\r\n  el: HTMLElement;\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.isSelected && !prevProps.isSelected) {\r\n      scrollIntoView(this.el);\r\n    }\r\n  }\r\n\r\n  getRef = el => {\r\n    this.el = el;\r\n  };\r\n\r\n  onClick = () => {\r\n    this.props.onClickItem(this.props.item);\r\n  };\r\n\r\n  render() {\r\n    const { isSelected, item } = this.props;\r\n    const className = isSelected ? 'typeahead-item typeahead-item__selected' : 'typeahead-item';\r\n    return (\r\n      <li ref={this.getRef} className={className} onClick={this.onClick}>\r\n        {item.detail || item.label}\r\n        {item.documentation && isSelected ? <div className=\"typeahead-item-hint\">{item.documentation}</div> : null}\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\ninterface TypeaheadGroupProps {\r\n  items: Suggestion[];\r\n  label: string;\r\n  onClickItem: (Suggestion) => void;\r\n  selected: Suggestion;\r\n}\r\n\r\nclass TypeaheadGroup extends React.PureComponent<TypeaheadGroupProps, {}> {\r\n  render() {\r\n    const { items, label, selected, onClickItem } = this.props;\r\n    return (\r\n      <li className=\"typeahead-group\">\r\n        <div className=\"typeahead-group__title\">{label}</div>\r\n        <ul className=\"typeahead-group__list\">\r\n          {items.map(item => {\r\n            return (\r\n              <TypeaheadItem key={item.label} onClickItem={onClickItem} isSelected={selected === item} item={item} />\r\n            );\r\n          })}\r\n        </ul>\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\ninterface TypeaheadProps {\r\n  groupedItems: SuggestionGroup[];\r\n  menuRef: any;\r\n  selectedItem: Suggestion | null;\r\n  onClickItem: (Suggestion) => void;\r\n}\r\nclass Typeahead extends React.PureComponent<TypeaheadProps, {}> {\r\n  render() {\r\n    const { groupedItems, menuRef, selectedItem, onClickItem } = this.props;\r\n    return (\r\n      <ul className=\"typeahead\" ref={menuRef}>\r\n        {groupedItems.map(g => (\r\n          <TypeaheadGroup key={g.label} onClickItem={onClickItem} selected={selectedItem} {...g} />\r\n        ))}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Typeahead;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Block, Change, Document, Text, Value } from 'slate';\r\nimport { Editor } from 'slate-react';\r\nimport Plain from 'slate-plain-serializer';\r\n\r\nimport ClearPlugin from './slate-plugins/clear';\r\nimport NewlinePlugin from './slate-plugins/newline';\r\n\r\nimport Typeahead from './Typeahead';\r\n\r\nexport const TYPEAHEAD_DEBOUNCE = 300;\r\n\r\nfunction flattenSuggestions(s: any[]): any[] {\r\n  return s ? s.reduce((acc, g) => acc.concat(g.items), []) : [];\r\n}\r\n\r\nexport const makeFragment = (text: string): Document => {\r\n  const lines = text.split('\\n').map(line =>\r\n    Block.create({\r\n      type: 'paragraph',\r\n      nodes: [Text.create(line)],\r\n    })\r\n  );\r\n\r\n  const fragment = Document.create({\r\n    nodes: lines,\r\n  });\r\n  return fragment;\r\n};\r\n\r\nexport const getInitialValue = (value: string): Value => Value.create({ document: makeFragment(value) });\r\n\r\nexport interface Suggestion {\r\n  /**\r\n   * The label of this completion item. By default\r\n   * this is also the text that is inserted when selecting\r\n   * this completion.\r\n   */\r\n  label: string;\r\n  /**\r\n   * The kind of this completion item. Based on the kind\r\n   * an icon is chosen by the editor.\r\n   */\r\n  kind?: string;\r\n  /**\r\n   * A human-readable string with additional information\r\n   * about this item, like type or symbol information.\r\n   */\r\n  detail?: string;\r\n  /**\r\n   * A human-readable string, can be Markdown, that represents a doc-comment.\r\n   */\r\n  documentation?: string;\r\n  /**\r\n   * A string that should be used when comparing this item\r\n   * with other items. When `falsy` the `label` is used.\r\n   */\r\n  sortText?: string;\r\n  /**\r\n   * A string that should be used when filtering a set of\r\n   * completion items. When `falsy` the `label` is used.\r\n   */\r\n  filterText?: string;\r\n  /**\r\n   * A string or snippet that should be inserted in a document when selecting\r\n   * this completion. When `falsy` the `label` is used.\r\n   */\r\n  insertText?: string;\r\n  /**\r\n   * Delete number of characters before the caret position,\r\n   * by default the letters from the beginning of the word.\r\n   */\r\n  deleteBackwards?: number;\r\n  /**\r\n   * Number of steps to move after the insertion, can be negative.\r\n   */\r\n  move?: number;\r\n}\r\n\r\nexport interface SuggestionGroup {\r\n  /**\r\n   * Label that will be displayed for all entries of this group.\r\n   */\r\n  label: string;\r\n  /**\r\n   * List of suggestions of this group.\r\n   */\r\n  items: Suggestion[];\r\n  /**\r\n   * If true, match only by prefix (and not mid-word).\r\n   */\r\n  prefixMatch?: boolean;\r\n  /**\r\n   * If true, do not filter items in this group based on the search.\r\n   */\r\n  skipFilter?: boolean;\r\n  /**\r\n   * If true, do not sort items.\r\n   */\r\n  skipSort?: boolean;\r\n}\r\n\r\ninterface TypeaheadFieldProps {\r\n  additionalPlugins?: any[];\r\n  cleanText?: (text: string) => string;\r\n  initialValue: string | null;\r\n  onBlur?: () => void;\r\n  onFocus?: () => void;\r\n  onTypeahead?: (typeahead: TypeaheadInput) => TypeaheadOutput;\r\n  onValueChanged?: (value: Value) => void;\r\n  onWillApplySuggestion?: (suggestion: string, state: TypeaheadFieldState) => string;\r\n  placeholder?: string;\r\n  portalPrefix?: string;\r\n}\r\n\r\nexport interface TypeaheadFieldState {\r\n  suggestions: SuggestionGroup[];\r\n  typeaheadContext: string | null;\r\n  typeaheadIndex: number;\r\n  typeaheadPrefix: string;\r\n  typeaheadText: string;\r\n  value: Value;\r\n}\r\n\r\nexport interface TypeaheadInput {\r\n  editorNode: Element;\r\n  prefix: string;\r\n  selection?: Selection;\r\n  text: string;\r\n  value: Value;\r\n  wrapperNode: Element;\r\n}\r\n\r\nexport interface TypeaheadOutput {\r\n  context?: string;\r\n  refresher?: Promise<{}>;\r\n  suggestions: SuggestionGroup[];\r\n}\r\n\r\nclass QueryField extends React.Component<TypeaheadFieldProps, TypeaheadFieldState> {\r\n  menuEl: HTMLElement | null;\r\n  plugins: any[];\r\n  resetTimer: any;\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    // Base plugins\r\n    this.plugins = [ClearPlugin(), NewlinePlugin(), ...props.additionalPlugins];\r\n\r\n    this.state = {\r\n      suggestions: [],\r\n      typeaheadContext: null,\r\n      typeaheadIndex: 0,\r\n      typeaheadPrefix: '',\r\n      typeaheadText: '',\r\n      value: getInitialValue(props.initialValue || ''),\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.updateMenu();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearTimeout(this.resetTimer);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateMenu();\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    // initialValue is null in case the user typed\r\n    if (nextProps.initialValue !== null && nextProps.initialValue !== this.props.initialValue) {\r\n      this.setState({ value: getInitialValue(nextProps.initialValue) });\r\n    }\r\n  }\r\n\r\n  onChange = ({ value }) => {\r\n    const changed = value.document !== this.state.value.document;\r\n    this.setState({ value }, () => {\r\n      if (changed) {\r\n        this.handleChangeValue();\r\n      }\r\n    });\r\n\r\n    if (changed) {\r\n      window.requestAnimationFrame(this.handleTypeahead);\r\n    }\r\n  };\r\n\r\n  handleChangeValue = () => {\r\n    // Send text change to parent\r\n    const { onValueChanged } = this.props;\r\n    if (onValueChanged) {\r\n      onValueChanged(Plain.serialize(this.state.value));\r\n    }\r\n  };\r\n\r\n  handleTypeahead = _.debounce(async () => {\r\n    const selection = window.getSelection();\r\n    const { cleanText, onTypeahead } = this.props;\r\n    const { value } = this.state;\r\n\r\n    if (onTypeahead && selection.anchorNode) {\r\n      const wrapperNode = selection.anchorNode.parentElement;\r\n      const editorNode = wrapperNode.closest('.slate-query-field');\r\n      if (!editorNode || this.state.value.isBlurred) {\r\n        // Not inside this editor\r\n        return;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n      const offset = range.startOffset;\r\n      const text = selection.anchorNode.textContent;\r\n      let prefix = text.substr(0, offset);\r\n      if (cleanText) {\r\n        prefix = cleanText(prefix);\r\n      }\r\n\r\n      const { suggestions, context, refresher } = onTypeahead({\r\n        editorNode,\r\n        prefix,\r\n        selection,\r\n        text,\r\n        value,\r\n        wrapperNode,\r\n      });\r\n\r\n      const filteredSuggestions = suggestions\r\n        .map(group => {\r\n          if (group.items) {\r\n            if (prefix) {\r\n              // Filter groups based on prefix\r\n              if (!group.skipFilter) {\r\n                group.items = group.items.filter(c => (c.filterText || c.label).length >= prefix.length);\r\n                if (group.prefixMatch) {\r\n                  group.items = group.items.filter(c => (c.filterText || c.label).indexOf(prefix) === 0);\r\n                } else {\r\n                  group.items = group.items.filter(c => (c.filterText || c.label).indexOf(prefix) > -1);\r\n                }\r\n              }\r\n              // Filter out the already typed value (prefix) unless it inserts custom text\r\n              group.items = group.items.filter(c => c.insertText || (c.filterText || c.label) !== prefix);\r\n            }\r\n\r\n            if (!group.skipSort) {\r\n              group.items = _.sortBy(group.items, item => item.sortText || item.label);\r\n            }\r\n          }\r\n          return group;\r\n        })\r\n        .filter(group => group.items && group.items.length > 0); // Filter out empty groups\r\n\r\n      this.setState(\r\n        {\r\n          suggestions: filteredSuggestions,\r\n          typeaheadPrefix: prefix,\r\n          typeaheadContext: context,\r\n          typeaheadText: text,\r\n        },\r\n        () => {\r\n          if (refresher) {\r\n            refresher.then(this.handleTypeahead).catch(e => console.error(e));\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }, TYPEAHEAD_DEBOUNCE);\r\n\r\n  applyTypeahead(change: Change, suggestion: Suggestion): Change {\r\n    const { cleanText, onWillApplySuggestion } = this.props;\r\n    const { typeaheadPrefix, typeaheadText } = this.state;\r\n    let suggestionText = suggestion.insertText || suggestion.label;\r\n    const move = suggestion.move || 0;\r\n\r\n    if (onWillApplySuggestion) {\r\n      suggestionText = onWillApplySuggestion(suggestionText, { ...this.state });\r\n    }\r\n\r\n    this.resetTypeahead();\r\n\r\n    // Remove the current, incomplete text and replace it with the selected suggestion\r\n    const backward = suggestion.deleteBackwards || typeaheadPrefix.length;\r\n    const text = cleanText ? cleanText(typeaheadText) : typeaheadText;\r\n    const suffixLength = text.length - typeaheadPrefix.length;\r\n    const offset = typeaheadText.indexOf(typeaheadPrefix);\r\n    const midWord = typeaheadPrefix && ((suffixLength > 0 && offset > -1) || suggestionText === typeaheadText);\r\n    const forward = midWord ? suffixLength + offset : 0;\r\n\r\n    // If new-lines, apply suggestion as block\r\n    if (suggestionText.match(/\\n/)) {\r\n      const fragment = makeFragment(suggestionText);\r\n      return change\r\n        .deleteBackward(backward)\r\n        .deleteForward(forward)\r\n        .insertFragment(fragment)\r\n        .focus();\r\n    }\r\n\r\n    return change\r\n      .deleteBackward(backward)\r\n      .deleteForward(forward)\r\n      .insertText(suggestionText)\r\n      .move(move)\r\n      .focus();\r\n  }\r\n\r\n  onKeyDown = (event, change) => {\r\n    const { typeaheadIndex, suggestions } = this.state;\r\n\r\n    switch (event.key) {\r\n      case 'Escape': {\r\n        if (this.menuEl) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          this.resetTypeahead();\r\n          return true;\r\n        }\r\n        break;\r\n      }\r\n\r\n      case ' ': {\r\n        if (event.ctrlKey) {\r\n          event.preventDefault();\r\n          this.handleTypeahead();\r\n          return true;\r\n        }\r\n        break;\r\n      }\r\n      case 'Enter':\r\n      case 'Tab': {\r\n        if (this.menuEl) {\r\n          // Dont blur input\r\n          event.preventDefault();\r\n          if (!suggestions || suggestions.length === 0) {\r\n            return undefined;\r\n          }\r\n\r\n          // Get the currently selected suggestion\r\n          const flattenedSuggestions = flattenSuggestions(suggestions);\r\n          const selected = Math.abs(typeaheadIndex);\r\n          const selectedIndex = selected % flattenedSuggestions.length || 0;\r\n          const suggestion = flattenedSuggestions[selectedIndex];\r\n\r\n          this.applyTypeahead(change, suggestion);\r\n          return true;\r\n        }\r\n        break;\r\n      }\r\n\r\n      case 'ArrowDown': {\r\n        if (this.menuEl) {\r\n          // Select next suggestion\r\n          event.preventDefault();\r\n          this.setState({ typeaheadIndex: typeaheadIndex + 1 });\r\n        }\r\n        break;\r\n      }\r\n\r\n      case 'ArrowUp': {\r\n        if (this.menuEl) {\r\n          // Select previous suggestion\r\n          event.preventDefault();\r\n          this.setState({ typeaheadIndex: Math.max(0, typeaheadIndex - 1) });\r\n        }\r\n        break;\r\n      }\r\n\r\n      default: {\r\n        // console.log('default key', event.key, event.which, event.charCode, event.locale, data.key);\r\n        break;\r\n      }\r\n    }\r\n    return undefined;\r\n  };\r\n\r\n  resetTypeahead = () => {\r\n    this.setState({\r\n      suggestions: [],\r\n      typeaheadIndex: 0,\r\n      typeaheadPrefix: '',\r\n      typeaheadContext: null,\r\n    });\r\n  };\r\n\r\n  handleBlur = () => {\r\n    const { onBlur } = this.props;\r\n    // If we dont wait here, menu clicks wont work because the menu\r\n    // will be gone.\r\n    this.resetTimer = setTimeout(this.resetTypeahead, 100);\r\n    if (onBlur) {\r\n      onBlur();\r\n    }\r\n  };\r\n\r\n  handleFocus = () => {\r\n    const { onFocus } = this.props;\r\n    if (onFocus) {\r\n      onFocus();\r\n    }\r\n  };\r\n\r\n  onClickMenu = (item: Suggestion) => {\r\n    // Manually triggering change\r\n    const change = this.applyTypeahead(this.state.value.change(), item);\r\n    this.onChange(change);\r\n  };\r\n\r\n  updateMenu = () => {\r\n    const { suggestions } = this.state;\r\n    const menu = this.menuEl;\r\n    const selection = window.getSelection();\r\n    const node = selection.anchorNode;\r\n\r\n    // No menu, nothing to do\r\n    if (!menu) {\r\n      return;\r\n    }\r\n\r\n    // No suggestions or blur, remove menu\r\n    const hasSuggesstions = suggestions && suggestions.length > 0;\r\n    if (!hasSuggesstions) {\r\n      menu.removeAttribute('style');\r\n      return;\r\n    }\r\n\r\n    // Align menu overlay to editor node\r\n    if (node) {\r\n      // Read from DOM\r\n      const rect = node.parentElement.getBoundingClientRect();\r\n      const scrollX = window.scrollX;\r\n      const scrollY = window.scrollY;\r\n\r\n      // Write DOM\r\n      requestAnimationFrame(() => {\r\n        menu.style.opacity = '1';\r\n        menu.style.top = `${rect.top + scrollY + rect.height + 4}px`;\r\n        menu.style.left = `${rect.left + scrollX - 2}px`;\r\n      });\r\n    }\r\n  };\r\n\r\n  menuRef = el => {\r\n    this.menuEl = el;\r\n  };\r\n\r\n  renderMenu = () => {\r\n    const { portalPrefix } = this.props;\r\n    const { suggestions } = this.state;\r\n    const hasSuggesstions = suggestions && suggestions.length > 0;\r\n    if (!hasSuggesstions) {\r\n      return null;\r\n    }\r\n\r\n    // Guard selectedIndex to be within the length of the suggestions\r\n    let selectedIndex = Math.max(this.state.typeaheadIndex, 0);\r\n    const flattenedSuggestions = flattenSuggestions(suggestions);\r\n    selectedIndex = selectedIndex % flattenedSuggestions.length || 0;\r\n    const selectedItem: Suggestion | null =\r\n      flattenedSuggestions.length > 0 ? flattenedSuggestions[selectedIndex] : null;\r\n\r\n    // Create typeahead in DOM root so we can later position it absolutely\r\n    return (\r\n      <Portal prefix={portalPrefix}>\r\n        <Typeahead\r\n          menuRef={this.menuRef}\r\n          selectedItem={selectedItem}\r\n          onClickItem={this.onClickMenu}\r\n          groupedItems={suggestions}\r\n        />\r\n      </Portal>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"slate-query-field\">\r\n        {this.renderMenu()}\r\n        <Editor\r\n          autoCorrect={false}\r\n          onBlur={this.handleBlur}\r\n          onKeyDown={this.onKeyDown}\r\n          onChange={this.onChange}\r\n          onFocus={this.handleFocus}\r\n          placeholder={this.props.placeholder}\r\n          plugins={this.plugins}\r\n          spellCheck={false}\r\n          value={this.state.value}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass Portal extends React.Component<{ index?: number; prefix: string }, {}> {\r\n  node: HTMLElement;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    const { index = 0, prefix = 'query' } = props;\r\n    this.node = document.createElement('div');\r\n    this.node.classList.add(`slate-typeahead`, `slate-typeahead-${prefix}-${index}`);\r\n    document.body.appendChild(this.node);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.body.removeChild(this.node);\r\n  }\r\n\r\n  render() {\r\n    return ReactDOM.createPortal(this.props.children, this.node);\r\n  }\r\n}\r\n\r\nexport default QueryField;\r\n","// Clears the rest of the line after the caret\r\nexport default function ClearPlugin() {\r\n  return {\r\n    onKeyDown(event, change) {\r\n      const { value } = change;\r\n      if (!value.isCollapsed) {\r\n        return undefined;\r\n      }\r\n\r\n      if (event.key === 'k' && event.ctrlKey) {\r\n        event.preventDefault();\r\n        const text = value.anchorText.text;\r\n        const offset = value.anchorOffset;\r\n        const length = text.length;\r\n        const forward = length - offset;\r\n        change.deleteForward(forward);\r\n        return true;\r\n      }\r\n      return undefined;\r\n    },\r\n  };\r\n}\r\n","function getIndent(text) {\r\n  let offset = text.length - text.trimLeft().length;\r\n  if (offset) {\r\n    let indent = text[0];\r\n    while (--offset) {\r\n      indent += text[0];\r\n    }\r\n    return indent;\r\n  }\r\n  return '';\r\n}\r\n\r\nexport default function NewlinePlugin() {\r\n  return {\r\n    onKeyDown(event, change) {\r\n      const { value } = change;\r\n      if (!value.isCollapsed) {\r\n        return undefined;\r\n      }\r\n\r\n      if (event.key === 'Enter' && event.shiftKey) {\r\n        event.preventDefault();\r\n\r\n        const { startBlock } = value;\r\n        const currentLineText = startBlock.text;\r\n        const indent = getIndent(currentLineText);\r\n\r\n        return change\r\n          .splitBlock()\r\n          .insertText(indent)\r\n          .focus();\r\n      }\r\n    },\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport moment from 'moment';\r\nimport React from 'react';\r\nimport { Value } from 'slate';\r\nimport Cascader from 'rc-cascader';\r\n\r\n// dom also includes Element polyfills\r\nimport { getNextCharacter, getPreviousCousin } from './utils/dom';\r\nimport PluginPrism, { setPrismTokens } from './slate-plugins/prism/index';\r\nimport PrismPromql, { FUNCTIONS } from './slate-plugins/prism/promql';\r\nimport BracesPlugin from './slate-plugins/braces';\r\nimport RunnerPlugin from './slate-plugins/runner';\r\nimport { processLabels, RATE_RANGES, cleanText, parseSelector } from './utils/prometheus';\r\n\r\nimport TypeaheadField, {\r\n  Suggestion,\r\n  SuggestionGroup,\r\n  TypeaheadInput,\r\n  TypeaheadFieldState,\r\n  TypeaheadOutput,\r\n} from './QueryField';\r\n\r\nconst DEFAULT_KEYS = ['job', 'instance'];\r\nconst EMPTY_SELECTOR = '{}';\r\nconst HISTOGRAM_GROUP = '__histograms__';\r\nconst HISTOGRAM_SELECTOR = '{le!=\"\"}'; // Returns all timeseries for histograms\r\nconst HISTORY_ITEM_COUNT = 5;\r\nconst HISTORY_COUNT_CUTOFF = 1000 * 60 * 60 * 24; // 24h\r\nconst METRIC_MARK = 'metric';\r\nconst PRISM_LANGUAGE = 'promql';\r\nexport const RECORDING_RULES_GROUP = '__recording_rules__';\r\n\r\nexport const wrapLabel = (label: string) => ({ label });\r\nexport const setFunctionMove = (suggestion: Suggestion): Suggestion => {\r\n  suggestion.move = -1;\r\n  return suggestion;\r\n};\r\n\r\nexport function addHistoryMetadata(item: Suggestion, history: any[]): Suggestion {\r\n  const cutoffTs = Date.now() - HISTORY_COUNT_CUTOFF;\r\n  const historyForItem = history.filter(h => h.ts > cutoffTs && h.query === item.label);\r\n  const count = historyForItem.length;\r\n  const recent = historyForItem[0];\r\n  let hint = `Queried ${count} times in the last 24h.`;\r\n  if (recent) {\r\n    const lastQueried = moment(recent.ts).fromNow();\r\n    hint = `${hint} Last queried ${lastQueried}.`;\r\n  }\r\n  return {\r\n    ...item,\r\n    documentation: hint,\r\n  };\r\n}\r\n\r\nexport function groupMetricsByPrefix(metrics: string[], delimiter = '_'): CascaderOption[] {\r\n  // Filter out recording rules and insert as first option\r\n  const ruleRegex = /:\\w+:/;\r\n  const ruleNames = metrics.filter(metric => ruleRegex.test(metric));\r\n  const rulesOption = {\r\n    label: 'Recording rules',\r\n    value: RECORDING_RULES_GROUP,\r\n    children: ruleNames\r\n      .slice()\r\n      .sort()\r\n      .map(name => ({ label: name, value: name })),\r\n  };\r\n\r\n  const options = ruleNames.length > 0 ? [rulesOption] : [];\r\n\r\n  const metricsOptions = _.chain(metrics)\r\n    .filter(metric => !ruleRegex.test(metric))\r\n    .groupBy(metric => metric.split(delimiter)[0])\r\n    .map((metricsForPrefix: string[], prefix: string): CascaderOption => {\r\n      const prefixIsMetric = metricsForPrefix.length === 1 && metricsForPrefix[0] === prefix;\r\n      const children = prefixIsMetric ? [] : metricsForPrefix.sort().map(m => ({ label: m, value: m }));\r\n      return {\r\n        children,\r\n        label: prefix,\r\n        value: prefix,\r\n      };\r\n    })\r\n    .sortBy('label')\r\n    .value();\r\n\r\n  return [...options, ...metricsOptions];\r\n}\r\n\r\nexport function willApplySuggestion(\r\n  suggestion: string,\r\n  { typeaheadContext, typeaheadText }: TypeaheadFieldState\r\n): string {\r\n  // Modify suggestion based on context\r\n  switch (typeaheadContext) {\r\n    case 'context-labels': {\r\n      const nextChar = getNextCharacter();\r\n      if (!nextChar || nextChar === '}' || nextChar === ',') {\r\n        suggestion += '=';\r\n      }\r\n      break;\r\n    }\r\n\r\n    case 'context-label-values': {\r\n      // Always add quotes and remove existing ones instead\r\n      if (!(typeaheadText.startsWith('=\"') || typeaheadText.startsWith('\"'))) {\r\n        suggestion = `\"${suggestion}`;\r\n      }\r\n      if (getNextCharacter() !== '\"') {\r\n        suggestion = `${suggestion}\"`;\r\n      }\r\n      break;\r\n    }\r\n\r\n    default:\r\n  }\r\n  return suggestion;\r\n}\r\n\r\ninterface CascaderOption {\r\n  label: string;\r\n  value: string;\r\n  children?: CascaderOption[];\r\n  disabled?: boolean;\r\n}\r\n\r\ninterface PromQueryFieldProps {\r\n  error?: string;\r\n  hint?: any;\r\n  histogramMetrics?: string[];\r\n  history?: any[];\r\n  initialQuery?: string | null;\r\n  labelKeys?: { [index: string]: string[] }; // metric -> [labelKey,...]\r\n  labelValues?: { [index: string]: { [index: string]: string[] } }; // metric -> labelKey -> [labelValue,...]\r\n  metrics?: string[];\r\n  metricsByPrefix?: CascaderOption[];\r\n  onClickHintFix?: (action: any) => void;\r\n  onPressEnter?: () => void;\r\n  onQueryChange?: (value: string, override?: boolean) => void;\r\n  portalPrefix?: string;\r\n  request?: (url: string) => any;\r\n}\r\n\r\ninterface PromQueryFieldState {\r\n  histogramMetrics: string[];\r\n  labelKeys: { [index: string]: string[] }; // metric -> [labelKey,...]\r\n  labelValues: { [index: string]: { [index: string]: string[] } }; // metric -> labelKey -> [labelValue,...]\r\n  metrics: string[];\r\n  metricsByPrefix: CascaderOption[];\r\n}\r\n\r\ninterface PromTypeaheadInput {\r\n  text: string;\r\n  prefix: string;\r\n  wrapperClasses: string[];\r\n  labelKey?: string;\r\n  value?: Value;\r\n}\r\n\r\nclass PromQueryField extends React.Component<PromQueryFieldProps, PromQueryFieldState> {\r\n  plugins: any[];\r\n\r\n  constructor(props: PromQueryFieldProps, context) {\r\n    super(props, context);\r\n\r\n    this.plugins = [\r\n      BracesPlugin(),\r\n      RunnerPlugin({ handler: props.onPressEnter }),\r\n      PluginPrism({ definition: PrismPromql, language: PRISM_LANGUAGE }),\r\n    ];\r\n\r\n    this.state = {\r\n      histogramMetrics: props.histogramMetrics || [],\r\n      labelKeys: props.labelKeys || {},\r\n      labelValues: props.labelValues || {},\r\n      metrics: props.metrics || [],\r\n      metricsByPrefix: props.metricsByPrefix || [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.fetchMetricNames();\r\n    this.fetchHistogramMetrics();\r\n  }\r\n\r\n  onChangeMetrics = (values: string[], selectedOptions: CascaderOption[]) => {\r\n    let query;\r\n    if (selectedOptions.length === 1) {\r\n      if (selectedOptions[0].children.length === 0) {\r\n        query = selectedOptions[0].value;\r\n      } else {\r\n        // Ignore click on group\r\n        return;\r\n      }\r\n    } else {\r\n      const prefix = selectedOptions[0].value;\r\n      const metric = selectedOptions[1].value;\r\n      if (prefix === HISTOGRAM_GROUP) {\r\n        query = `histogram_quantile(0.95, sum(rate(${metric}[5m])) by (le))`;\r\n      } else {\r\n        query = metric;\r\n      }\r\n    }\r\n    this.onChangeQuery(query, true);\r\n  };\r\n\r\n  onChangeQuery = (value: string, override?: boolean) => {\r\n    // Send text change to parent\r\n    const { onQueryChange } = this.props;\r\n    if (onQueryChange) {\r\n      onQueryChange(value, override);\r\n    }\r\n  };\r\n\r\n  onClickHintFix = () => {\r\n    const { hint, onClickHintFix } = this.props;\r\n    if (onClickHintFix && hint && hint.fix) {\r\n      onClickHintFix(hint.fix.action);\r\n    }\r\n  };\r\n\r\n  onReceiveMetrics = () => {\r\n    if (!this.state.metrics) {\r\n      return;\r\n    }\r\n    setPrismTokens(PRISM_LANGUAGE, METRIC_MARK, this.state.metrics);\r\n  };\r\n\r\n  onTypeahead = (typeahead: TypeaheadInput): TypeaheadOutput => {\r\n    const { prefix, text, value, wrapperNode } = typeahead;\r\n\r\n    // Get DOM-dependent context\r\n    const wrapperClasses = Array.from(wrapperNode.classList);\r\n    const labelKeyNode = getPreviousCousin(wrapperNode, '.attr-name');\r\n    const labelKey = labelKeyNode && labelKeyNode.textContent;\r\n    const nextChar = getNextCharacter();\r\n\r\n    const result = this.getTypeahead({ text, value, prefix, wrapperClasses, labelKey });\r\n\r\n    console.log('handleTypeahead', wrapperClasses, text, prefix, nextChar, labelKey, result.context);\r\n\r\n    return result;\r\n  };\r\n\r\n  // Keep this DOM-free for testing\r\n  getTypeahead({ prefix, wrapperClasses, text }: PromTypeaheadInput): TypeaheadOutput {\r\n    // Determine candidates by CSS context\r\n    if (_.includes(wrapperClasses, 'context-range')) {\r\n      // Suggestions for metric[|]\r\n      return this.getRangeTypeahead();\r\n    } else if (_.includes(wrapperClasses, 'context-labels')) {\r\n      // Suggestions for metric{|} and metric{foo=|}, as well as metric-independent label queries like {|}\r\n      return this.getLabelTypeahead.apply(this, arguments);\r\n    } else if (_.includes(wrapperClasses, 'context-aggregation')) {\r\n      return this.getAggregationTypeahead.apply(this, arguments);\r\n    } else if (\r\n      // Non-empty but not inside known token\r\n      (prefix && !_.includes(wrapperClasses, 'token')) ||\r\n      (prefix === '' && !text.match(/^[)\\s]+$/)) || // Empty context or after ')'\r\n      text.match(/[+\\-*/^%]/) // After binary operator\r\n    ) {\r\n      return this.getEmptyTypeahead();\r\n    }\r\n\r\n    return {\r\n      suggestions: [],\r\n    };\r\n  }\r\n\r\n  getEmptyTypeahead(): TypeaheadOutput {\r\n    const { history } = this.props;\r\n    const { metrics } = this.state;\r\n    const suggestions: SuggestionGroup[] = [];\r\n\r\n    if (history && history.length > 0) {\r\n      const historyItems = _.chain(history)\r\n        .uniqBy('query')\r\n        .take(HISTORY_ITEM_COUNT)\r\n        .map(h => h.query)\r\n        .map(wrapLabel)\r\n        .map(item => addHistoryMetadata(item, history))\r\n        .value();\r\n\r\n      suggestions.push({\r\n        prefixMatch: true,\r\n        skipSort: true,\r\n        label: 'History',\r\n        items: historyItems,\r\n      });\r\n    }\r\n\r\n    suggestions.push({\r\n      prefixMatch: true,\r\n      label: 'Functions',\r\n      items: FUNCTIONS.map(setFunctionMove),\r\n    });\r\n\r\n    if (metrics) {\r\n      suggestions.push({\r\n        label: 'Metrics',\r\n        items: metrics.map(wrapLabel),\r\n      });\r\n    }\r\n    return { suggestions };\r\n  }\r\n\r\n  getRangeTypeahead(): TypeaheadOutput {\r\n    return {\r\n      context: 'context-range',\r\n      suggestions: [\r\n        {\r\n          label: 'Range vector',\r\n          items: [...RATE_RANGES].map(wrapLabel),\r\n        },\r\n      ],\r\n    };\r\n  }\r\n\r\n  getAggregationTypeahead({ value }: PromTypeaheadInput): TypeaheadOutput {\r\n    let refresher: Promise<any> = null;\r\n    const suggestions: SuggestionGroup[] = [];\r\n\r\n    // sum(foo{bar=\"1\"}) by (|)\r\n    const line = value.anchorBlock.getText();\r\n    const cursorOffset: number = value.anchorOffset;\r\n    // sum(foo{bar=\"1\"}) by (\r\n    const leftSide = line.slice(0, cursorOffset);\r\n    const openParensAggregationIndex = leftSide.lastIndexOf('(');\r\n    const openParensSelectorIndex = leftSide.slice(0, openParensAggregationIndex).lastIndexOf('(');\r\n    const closeParensSelectorIndex = leftSide.slice(openParensSelectorIndex).indexOf(')') + openParensSelectorIndex;\r\n    // foo{bar=\"1\"}\r\n    const selectorString = leftSide.slice(openParensSelectorIndex + 1, closeParensSelectorIndex);\r\n    const selector = parseSelector(selectorString, selectorString.length - 2).selector;\r\n\r\n    const labelKeys = this.state.labelKeys[selector];\r\n    if (labelKeys) {\r\n      suggestions.push({ label: 'Labels', items: labelKeys.map(wrapLabel) });\r\n    } else {\r\n      refresher = this.fetchSeriesLabels(selector);\r\n    }\r\n\r\n    return {\r\n      refresher,\r\n      suggestions,\r\n      context: 'context-aggregation',\r\n    };\r\n  }\r\n\r\n  getLabelTypeahead({ text, wrapperClasses, labelKey, value }: PromTypeaheadInput): TypeaheadOutput {\r\n    let context: string;\r\n    let refresher: Promise<any> = null;\r\n    const suggestions: SuggestionGroup[] = [];\r\n    const line = value.anchorBlock.getText();\r\n    const cursorOffset: number = value.anchorOffset;\r\n\r\n    // Get normalized selector\r\n    let selector;\r\n    let parsedSelector;\r\n    try {\r\n      parsedSelector = parseSelector(line, cursorOffset);\r\n      selector = parsedSelector.selector;\r\n    } catch {\r\n      selector = EMPTY_SELECTOR;\r\n    }\r\n    const containsMetric = selector.indexOf('__name__=') > -1;\r\n    const existingKeys = parsedSelector ? parsedSelector.labelKeys : [];\r\n\r\n    if ((text && text.startsWith('=')) || _.includes(wrapperClasses, 'attr-value')) {\r\n      // Label values\r\n      if (labelKey && this.state.labelValues[selector] && this.state.labelValues[selector][labelKey]) {\r\n        const labelValues = this.state.labelValues[selector][labelKey];\r\n        context = 'context-label-values';\r\n        suggestions.push({\r\n          label: `Label values for \"${labelKey}\"`,\r\n          items: labelValues.map(wrapLabel),\r\n        });\r\n      }\r\n    } else {\r\n      // Label keys\r\n      const labelKeys = this.state.labelKeys[selector] || (containsMetric ? null : DEFAULT_KEYS);\r\n      if (labelKeys) {\r\n        const possibleKeys = _.difference(labelKeys, existingKeys);\r\n        if (possibleKeys.length > 0) {\r\n          context = 'context-labels';\r\n          suggestions.push({ label: `Labels`, items: possibleKeys.map(wrapLabel) });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Query labels for selector\r\n    if (selector && !this.state.labelValues[selector]) {\r\n      if (selector === EMPTY_SELECTOR) {\r\n        // Query label values for default labels\r\n        refresher = Promise.all(DEFAULT_KEYS.map(key => this.fetchLabelValues(key)));\r\n      } else {\r\n        refresher = this.fetchSeriesLabels(selector, !containsMetric);\r\n      }\r\n    }\r\n\r\n    return { context, refresher, suggestions };\r\n  }\r\n\r\n  request = url => {\r\n    if (this.props.request) {\r\n      return this.props.request(url);\r\n    }\r\n    return fetch(url);\r\n  };\r\n\r\n  fetchHistogramMetrics() {\r\n    this.fetchSeriesLabels(HISTOGRAM_SELECTOR, true, () => {\r\n      const histogramSeries = this.state.labelValues[HISTOGRAM_SELECTOR];\r\n      if (histogramSeries && histogramSeries['__name__']) {\r\n        const histogramMetrics = histogramSeries['__name__'].slice().sort();\r\n        this.setState({ histogramMetrics });\r\n      }\r\n    });\r\n  }\r\n\r\n  async fetchLabelValues(key: string) {\r\n    const url = `/api/v1/label/${key}/values`;\r\n    try {\r\n      const res = await this.request(url);\r\n      const body = await (res.data || res.json());\r\n      const exisingValues = this.state.labelValues[EMPTY_SELECTOR];\r\n      const values = {\r\n        ...exisingValues,\r\n        [key]: body.data,\r\n      };\r\n      const labelValues = {\r\n        ...this.state.labelValues,\r\n        [EMPTY_SELECTOR]: values,\r\n      };\r\n      this.setState({ labelValues });\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  }\r\n\r\n  async fetchSeriesLabels(name: string, withName?: boolean, callback?: () => void) {\r\n    const url = `/api/v1/series?match[]=${name}`;\r\n    try {\r\n      const res = await this.request(url);\r\n      const body = await (res.data || res.json());\r\n      const { keys, values } = processLabels(body.data, withName);\r\n      const labelKeys = {\r\n        ...this.state.labelKeys,\r\n        [name]: keys,\r\n      };\r\n      const labelValues = {\r\n        ...this.state.labelValues,\r\n        [name]: values,\r\n      };\r\n      this.setState({ labelKeys, labelValues }, callback);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  }\r\n\r\n  async fetchMetricNames() {\r\n    const url = '/api/v1/label/__name__/values';\r\n    try {\r\n      const res = await this.request(url);\r\n      const body = await (res.data || res.json());\r\n      const metrics = body.data;\r\n      const metricsByPrefix = groupMetricsByPrefix(metrics);\r\n      this.setState({ metrics, metricsByPrefix }, this.onReceiveMetrics);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { error, hint } = this.props;\r\n    const { histogramMetrics, metricsByPrefix } = this.state;\r\n    const histogramOptions = histogramMetrics.map(hm => ({ label: hm, value: hm }));\r\n    const metricsOptions = [\r\n      { label: 'Histograms', value: HISTOGRAM_GROUP, children: histogramOptions },\r\n      ...metricsByPrefix,\r\n    ];\r\n\r\n    return (\r\n      <div className=\"prom-query-field\">\r\n        <div className=\"prom-query-field-tools\">\r\n          <Cascader options={metricsOptions} onChange={this.onChangeMetrics}>\r\n            <button className=\"btn navbar-button navbar-button--tight\">Metrics</button>\r\n          </Cascader>\r\n        </div>\r\n        <div className=\"prom-query-field-wrapper\">\r\n          <div className=\"slate-query-field-wrapper\">\r\n            <TypeaheadField\r\n              additionalPlugins={this.plugins}\r\n              cleanText={cleanText}\r\n              initialValue={this.props.initialQuery}\r\n              onTypeahead={this.onTypeahead}\r\n              onWillApplySuggestion={willApplySuggestion}\r\n              onValueChanged={this.onChangeQuery}\r\n              placeholder=\"Enter a PromQL query\"\r\n            />\r\n          </div>\r\n          {error ? <div className=\"prom-query-field-info text-error\">{error}</div> : null}\r\n          {hint ? (\r\n            <div className=\"prom-query-field-info text-warning\">\r\n              {hint.label}{' '}\r\n              {hint.fix ? (\r\n                <a className=\"text-link muted\" onClick={this.onClickHintFix}>\r\n                  {hint.fix.label}\r\n                </a>\r\n              ) : null}\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PromQueryField;\r\n","export default function RunnerPlugin({ handler }) {\r\n  return {\r\n    onKeyDown(event) {\r\n      // Handle enter\r\n      if (handler && event.key === 'Enter' && !event.shiftKey) {\r\n        // Submit on Enter\r\n        event.preventDefault();\r\n        handler(event);\r\n        return true;\r\n      }\r\n      return undefined;\r\n    },\r\n  };\r\n}\r\n","import React, { PureComponent } from 'react';\r\n\r\n// TODO make this datasource-plugin-dependent\r\nimport QueryField from './PromQueryField';\r\n\r\nclass QueryRow extends PureComponent<any, {}> {\r\n  onChangeQuery = (value, override?: boolean) => {\r\n    const { index, onChangeQuery } = this.props;\r\n    if (onChangeQuery) {\r\n      onChangeQuery(value, index, override);\r\n    }\r\n  };\r\n\r\n  onClickAddButton = () => {\r\n    const { index, onAddQueryRow } = this.props;\r\n    if (onAddQueryRow) {\r\n      onAddQueryRow(index);\r\n    }\r\n  };\r\n\r\n  onClickClearButton = () => {\r\n    this.onChangeQuery('', true);\r\n  };\r\n\r\n  onClickHintFix = action => {\r\n    const { index, onClickHintFix } = this.props;\r\n    if (onClickHintFix) {\r\n      onClickHintFix(action, index);\r\n    }\r\n  };\r\n\r\n  onClickRemoveButton = () => {\r\n    const { index, onRemoveQueryRow } = this.props;\r\n    if (onRemoveQueryRow) {\r\n      onRemoveQueryRow(index);\r\n    }\r\n  };\r\n\r\n  onPressEnter = () => {\r\n    const { onExecuteQuery } = this.props;\r\n    if (onExecuteQuery) {\r\n      onExecuteQuery();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { edited, history, query, queryError, queryHint, request } = this.props;\r\n    return (\r\n      <div className=\"query-row\">\r\n        <div className=\"query-row-field\">\r\n          <QueryField\r\n            error={queryError}\r\n            hint={queryHint}\r\n            initialQuery={edited ? null : query}\r\n            history={history}\r\n            portalPrefix=\"explore\"\r\n            onClickHintFix={this.onClickHintFix}\r\n            onPressEnter={this.onPressEnter}\r\n            onQueryChange={this.onChangeQuery}\r\n            request={request}\r\n          />\r\n        </div>\r\n        <div className=\"query-row-tools\">\r\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickClearButton}>\r\n            <i className=\"fa fa-times\" />\r\n          </button>\r\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickAddButton}>\r\n            <i className=\"fa fa-plus\" />\r\n          </button>\r\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickRemoveButton}>\r\n            <i className=\"fa fa-minus\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default class QueryRows extends PureComponent<any, {}> {\r\n  render() {\r\n    const { className = '', queries, queryErrors = [], queryHints = [], ...handlers } = this.props;\r\n    return (\r\n      <div className={className}>\r\n        {queries.map((q, index) => (\r\n          <QueryRow\r\n            key={q.key}\r\n            index={index}\r\n            query={q.query}\r\n            queryError={queryErrors[index]}\r\n            queryHint={queryHints[index]}\r\n            edited={q.edited}\r\n            {...handlers}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","export function generateQueryKey(index = 0) {\r\n  return `Q-${Date.now()}-${Math.random()}-${index}`;\r\n}\r\n\r\nexport function ensureQueries(queries?) {\r\n  if (queries && typeof queries === 'object' && queries.length > 0 && typeof queries[0] === 'string') {\r\n    return queries.map((query, i) => ({ key: generateQueryKey(i), query }));\r\n  }\r\n  return [{ key: generateQueryKey(), query: '' }];\r\n}\r\n\r\nexport function hasQuery(queries) {\r\n  return queries.some(q => q.query);\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport moment from 'moment';\r\n\r\nimport * as dateMath from 'app/core/utils/datemath';\r\nimport * as rangeUtil from 'app/core/utils/rangeutil';\r\n\r\nconst DATE_FORMAT = 'YYYY-MM-DD HH:mm:ss';\r\n\r\nexport const DEFAULT_RANGE = {\r\n  from: 'now-6h',\r\n  to: 'now',\r\n};\r\n\r\nexport function parseTime(value, isUtc = false, asString = false) {\r\n  if (value.indexOf('now') !== -1) {\r\n    return value;\r\n  }\r\n  if (!isNaN(value)) {\r\n    const epoch = parseInt(value);\r\n    const m = isUtc ? moment.utc(epoch) : moment(epoch);\r\n    return asString ? m.format(DATE_FORMAT) : m;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport default class TimePicker extends PureComponent<any, any> {\r\n  dropdownEl: any;\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const fromRaw = props.range ? props.range.from : DEFAULT_RANGE.from;\r\n    const toRaw = props.range ? props.range.to : DEFAULT_RANGE.to;\r\n    const range = {\r\n      from: parseTime(fromRaw),\r\n      to: parseTime(toRaw),\r\n    };\r\n    this.state = {\r\n      fromRaw: parseTime(fromRaw, props.isUtc, true),\r\n      isOpen: props.isOpen,\r\n      isUtc: props.isUtc,\r\n      rangeString: rangeUtil.describeTimeRange(range),\r\n      refreshInterval: '',\r\n      toRaw: parseTime(toRaw, props.isUtc, true),\r\n    };\r\n  }\r\n\r\n  move(direction) {\r\n    const { onChangeTime } = this.props;\r\n    const { fromRaw, toRaw } = this.state;\r\n    const range = {\r\n      from: dateMath.parse(fromRaw, false),\r\n      to: dateMath.parse(toRaw, true),\r\n    };\r\n\r\n    const timespan = (range.to.valueOf() - range.from.valueOf()) / 2;\r\n    let to, from;\r\n    if (direction === -1) {\r\n      to = range.to.valueOf() - timespan;\r\n      from = range.from.valueOf() - timespan;\r\n    } else if (direction === 1) {\r\n      to = range.to.valueOf() + timespan;\r\n      from = range.from.valueOf() + timespan;\r\n      if (to > Date.now() && range.to < Date.now()) {\r\n        to = Date.now();\r\n        from = range.from.valueOf();\r\n      }\r\n    } else {\r\n      to = range.to.valueOf();\r\n      from = range.from.valueOf();\r\n    }\r\n\r\n    const rangeString = rangeUtil.describeTimeRange(range);\r\n    // No need to convert to UTC again\r\n    to = moment(to);\r\n    from = moment(from);\r\n\r\n    this.setState(\r\n      {\r\n        rangeString,\r\n        fromRaw: from.format(DATE_FORMAT),\r\n        toRaw: to.format(DATE_FORMAT),\r\n      },\r\n      () => {\r\n        onChangeTime({ to, from });\r\n      }\r\n    );\r\n  }\r\n\r\n  handleChangeFrom = e => {\r\n    this.setState({\r\n      fromRaw: e.target.value,\r\n    });\r\n  };\r\n\r\n  handleChangeTo = e => {\r\n    this.setState({\r\n      toRaw: e.target.value,\r\n    });\r\n  };\r\n\r\n  handleClickApply = () => {\r\n    const { onChangeTime } = this.props;\r\n    const { toRaw, fromRaw } = this.state;\r\n    const range = {\r\n      from: dateMath.parse(fromRaw, false),\r\n      to: dateMath.parse(toRaw, true),\r\n    };\r\n    const rangeString = rangeUtil.describeTimeRange(range);\r\n    this.setState(\r\n      {\r\n        isOpen: false,\r\n        rangeString,\r\n      },\r\n      () => {\r\n        if (onChangeTime) {\r\n          onChangeTime(range);\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  handleClickLeft = () => this.move(-1);\r\n  handleClickPicker = () => {\r\n    this.setState(state => ({\r\n      isOpen: !state.isOpen,\r\n    }));\r\n  };\r\n  handleClickRight = () => this.move(1);\r\n  handleClickRefresh = () => {};\r\n  handleClickRelativeOption = range => {\r\n    const { onChangeTime } = this.props;\r\n    const rangeString = rangeUtil.describeTimeRange(range);\r\n    this.setState(\r\n      {\r\n        toRaw: range.to,\r\n        fromRaw: range.from,\r\n        isOpen: false,\r\n        rangeString,\r\n      },\r\n      () => {\r\n        if (onChangeTime) {\r\n          onChangeTime(range);\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  getTimeOptions() {\r\n    return rangeUtil.getRelativeTimesList({}, this.state.rangeString);\r\n  }\r\n\r\n  dropdownRef = el => {\r\n    this.dropdownEl = el;\r\n  };\r\n\r\n  renderDropdown() {\r\n    const { fromRaw, isOpen, toRaw } = this.state;\r\n    if (!isOpen) {\r\n      return null;\r\n    }\r\n    const timeOptions = this.getTimeOptions();\r\n    return (\r\n      <div ref={this.dropdownRef} className=\"gf-timepicker-dropdown\">\r\n        <div className=\"gf-timepicker-absolute-section\">\r\n          <h3 className=\"section-heading\">Custom range</h3>\r\n\r\n          <label className=\"small\">From:</label>\r\n          <div className=\"gf-form-inline\">\r\n            <div className=\"gf-form max-width-28\">\r\n              <input\r\n                type=\"text\"\r\n                className=\"gf-form-input input-large timepicker-from\"\r\n                value={fromRaw}\r\n                onChange={this.handleChangeFrom}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <label className=\"small\">To:</label>\r\n          <div className=\"gf-form-inline\">\r\n            <div className=\"gf-form max-width-28\">\r\n              <input\r\n                type=\"text\"\r\n                className=\"gf-form-input input-large timepicker-to\"\r\n                value={toRaw}\r\n                onChange={this.handleChangeTo}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* <label className=\"small\">Refreshing every:</label>\r\n          <div className=\"gf-form-inline\">\r\n            <div className=\"gf-form max-width-28\">\r\n              <select className=\"gf-form-input input-medium\" ng-options=\"f.value as f.text for f in ctrl.refresh.options\"></select>\r\n            </div>\r\n          </div> */}\r\n          <div className=\"gf-form\">\r\n            <button className=\"btn gf-form-btn btn-secondary\" onClick={this.handleClickApply}>\r\n              Apply\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"gf-timepicker-relative-section\">\r\n          <h3 className=\"section-heading\">Quick ranges</h3>\r\n          {Object.keys(timeOptions).map(section => {\r\n            const group = timeOptions[section];\r\n            return (\r\n              <ul key={section}>\r\n                {group.map(option => (\r\n                  <li className={option.active ? 'active' : ''} key={option.display}>\r\n                    <a onClick={() => this.handleClickRelativeOption(option)}>{option.display}</a>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { isUtc, rangeString, refreshInterval } = this.state;\r\n    return (\r\n      <div className=\"timepicker\">\r\n        <div className=\"navbar-buttons\">\r\n          <button className=\"btn navbar-button navbar-button--tight timepicker-left\" onClick={this.handleClickLeft}>\r\n            <i className=\"fa fa-chevron-left\" />\r\n          </button>\r\n          <button className=\"btn navbar-button gf-timepicker-nav-btn\" onClick={this.handleClickPicker}>\r\n            <i className=\"fa fa-clock-o\" />\r\n            <span className=\"timepicker-rangestring\">{rangeString}</span>\r\n            {isUtc ? <span className=\"gf-timepicker-utc\">UTC</span> : null}\r\n            {refreshInterval ? <span className=\"text-warning\">&nbsp; Refresh every {refreshInterval}</span> : null}\r\n          </button>\r\n          <button className=\"btn navbar-button navbar-button--tight timepicker-right\" onClick={this.handleClickRight}>\r\n            <i className=\"fa fa-chevron-right\" />\r\n          </button>\r\n        </div>\r\n        {this.renderDropdown()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport TableModel from 'app/core/table_model';\r\n\r\nconst EMPTY_TABLE = new TableModel();\r\n\r\ninterface TableProps {\r\n  className?: string;\r\n  data: TableModel;\r\n  loading: boolean;\r\n  onClickCell?: (columnKey: string, rowValue: string) => void;\r\n}\r\n\r\ninterface SFCCellProps {\r\n  columnIndex: number;\r\n  onClickCell?: (columnKey: string, rowValue: string, columnIndex: number, rowIndex: number, table: TableModel) => void;\r\n  rowIndex: number;\r\n  table: TableModel;\r\n  value: string;\r\n}\r\n\r\nfunction Cell(props: SFCCellProps) {\r\n  const { columnIndex, rowIndex, table, value, onClickCell } = props;\r\n  const column = table.columns[columnIndex];\r\n  if (column && column.filterable && onClickCell) {\r\n    const onClick = event => {\r\n      event.preventDefault();\r\n      onClickCell(column.text, value, columnIndex, rowIndex, table);\r\n    };\r\n    return (\r\n      <td>\r\n        <a className=\"link\" onClick={onClick}>\r\n          {value}\r\n        </a>\r\n      </td>\r\n    );\r\n  }\r\n  return <td>{value}</td>;\r\n}\r\n\r\nexport default class Table extends PureComponent<TableProps, {}> {\r\n  render() {\r\n    const { className = '', data, loading, onClickCell } = this.props;\r\n    const tableModel = data || EMPTY_TABLE;\r\n    if (!loading && data && data.rows.length === 0) {\r\n      return (\r\n        <table className={`${className} filter-table`}>\r\n          <thead>\r\n            <tr>\r\n              <th>Table</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr>\r\n              <td className=\"muted\">The queries returned no data for a table.</td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      );\r\n    }\r\n    return (\r\n      <table className={`${className} filter-table`}>\r\n        <thead>\r\n          <tr>{tableModel.columns.map(col => <th key={col.text}>{col.text}</th>)}</tr>\r\n        </thead>\r\n        <tbody>\r\n          {tableModel.rows.map((row, i) => (\r\n            <tr key={i}>\r\n              {row.map((value, j) => (\r\n                <Cell\r\n                  key={j}\r\n                  columnIndex={j}\r\n                  rowIndex={i}\r\n                  value={String(value)}\r\n                  table={data}\r\n                  onClickCell={onClickCell}\r\n                />\r\n              ))}\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment, PureComponent } from 'react';\r\n\r\nimport { LogsModel, LogRow } from 'app/core/logs_model';\r\n\r\ninterface LogsProps {\r\n  className?: string;\r\n  data: LogsModel;\r\n  loading: boolean;\r\n}\r\n\r\nconst EXAMPLE_QUERY = '{job=\"default/prometheus\"}';\r\n\r\nconst Entry: React.SFC<LogRow> = props => {\r\n  const { entry, searchMatches } = props;\r\n  if (searchMatches && searchMatches.length > 0) {\r\n    let lastMatchEnd = 0;\r\n    const spans = searchMatches.reduce((acc, match, i) => {\r\n      // Insert non-match\r\n      if (match.start !== lastMatchEnd) {\r\n        acc.push(<>{entry.slice(lastMatchEnd, match.start)}</>);\r\n      }\r\n      // Match\r\n      acc.push(\r\n        <span className=\"logs-row-match-highlight\" title={`Matching expression: ${match.text}`}>\r\n          {entry.substr(match.start, match.length)}\r\n        </span>\r\n      );\r\n      lastMatchEnd = match.start + match.length;\r\n      // Non-matching end\r\n      if (i === searchMatches.length - 1) {\r\n        acc.push(<>{entry.slice(lastMatchEnd)}</>);\r\n      }\r\n      return acc;\r\n    }, []);\r\n    return <>{spans}</>;\r\n  }\r\n  return <>{props.entry}</>;\r\n};\r\n\r\nexport default class Logs extends PureComponent<LogsProps, any> {\r\n  render() {\r\n    const { className = '', data } = this.props;\r\n    const hasData = data && data.rows && data.rows.length > 0;\r\n    return (\r\n      <div className={`${className} logs`}>\r\n        {hasData ? (\r\n          <div className=\"logs-entries panel-container\">\r\n            {data.rows.map(row => (\r\n              <Fragment key={row.key}>\r\n                <div className={row.logLevel ? `logs-row-level logs-row-level-${row.logLevel}` : ''} />\r\n                <div title={`${row.timestamp} (${row.timeFromNow})`}>{row.timeLocal}</div>\r\n                <div>\r\n                  <Entry {...row} />\r\n                </div>\r\n              </Fragment>\r\n            ))}\r\n          </div>\r\n        ) : null}\r\n        {!hasData ? (\r\n          <div className=\"panel-container\">\r\n            Enter a query like <code>{EXAMPLE_QUERY}</code>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\n\r\nconst INTERVAL = 150;\r\n\r\nexport default class ElapsedTime extends PureComponent<any, any> {\r\n  offset: number;\r\n  timer: number;\r\n\r\n  state = {\r\n    elapsed: 0,\r\n  };\r\n\r\n  start() {\r\n    this.offset = Date.now();\r\n    this.timer = window.setInterval(this.tick, INTERVAL);\r\n  }\r\n\r\n  tick = () => {\r\n    const jetzt = Date.now();\r\n    const elapsed = jetzt - this.offset;\r\n    this.setState({ elapsed });\r\n  };\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    if (nextProps.time) {\r\n      clearInterval(this.timer);\r\n    } else if (this.props.time) {\r\n      this.start();\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.start();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearInterval(this.timer);\r\n  }\r\n\r\n  render() {\r\n    const { elapsed } = this.state;\r\n    const { className, time } = this.props;\r\n    const value = (time || elapsed) / 1000;\r\n    return <span className={`elapsed-time ${className}`}>{value.toFixed(1)}s</span>;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { hot } from 'react-hot-loader';\r\nimport Select from 'react-select';\r\n\r\nimport kbn from 'app/core/utils/kbn';\r\nimport colors from 'app/core/utils/colors';\r\nimport store from 'app/core/store';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport { decodePathComponent } from 'app/core/utils/location_util';\r\nimport { parse as parseDate } from 'app/core/utils/datemath';\r\n\r\nimport ElapsedTime from './ElapsedTime';\r\nimport QueryRows from './QueryRows';\r\nimport Graph from './Graph';\r\nimport Logs from './Logs';\r\nimport Table from './Table';\r\nimport TimePicker, { DEFAULT_RANGE } from './TimePicker';\r\nimport { ensureQueries, generateQueryKey, hasQuery } from './utils/query';\r\n\r\nconst MAX_HISTORY_ITEMS = 100;\r\n\r\nfunction makeHints(hints) {\r\n  const hintsByIndex = [];\r\n  hints.forEach(hint => {\r\n    if (hint) {\r\n      hintsByIndex[hint.index] = hint;\r\n    }\r\n  });\r\n  return hintsByIndex;\r\n}\r\n\r\nfunction makeTimeSeriesList(dataList, options) {\r\n  return dataList.map((seriesData, index) => {\r\n    const datapoints = seriesData.datapoints || [];\r\n    const alias = seriesData.target;\r\n    const colorIndex = index % colors.length;\r\n    const color = colors[colorIndex];\r\n\r\n    const series = new TimeSeries({\r\n      datapoints,\r\n      alias,\r\n      color,\r\n      unit: seriesData.unit,\r\n    });\r\n\r\n    return series;\r\n  });\r\n}\r\n\r\nfunction parseUrlState(initial: string | undefined) {\r\n  if (initial) {\r\n    try {\r\n      const parsed = JSON.parse(decodePathComponent(initial));\r\n      return {\r\n        datasource: parsed.datasource,\r\n        queries: parsed.queries.map(q => q.query),\r\n        range: parsed.range,\r\n      };\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  }\r\n  return { datasource: null, queries: [], range: DEFAULT_RANGE };\r\n}\r\n\r\ninterface ExploreState {\r\n  datasource: any;\r\n  datasourceError: any;\r\n  datasourceLoading: boolean | null;\r\n  datasourceMissing: boolean;\r\n  graphResult: any;\r\n  history: any[];\r\n  initialDatasource?: string;\r\n  latency: number;\r\n  loading: any;\r\n  logsResult: any;\r\n  queries: any[];\r\n  queryErrors: any[];\r\n  queryHints: any[];\r\n  range: any;\r\n  requestOptions: any;\r\n  showingGraph: boolean;\r\n  showingLogs: boolean;\r\n  showingTable: boolean;\r\n  supportsGraph: boolean | null;\r\n  supportsLogs: boolean | null;\r\n  supportsTable: boolean | null;\r\n  tableResult: any;\r\n}\r\n\r\nexport class Explore extends React.Component<any, ExploreState> {\r\n  el: any;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    const initialState: ExploreState = props.initialState;\r\n    const { datasource, queries, range } = parseUrlState(props.routeParams.state);\r\n    this.state = {\r\n      datasource: null,\r\n      datasourceError: null,\r\n      datasourceLoading: null,\r\n      datasourceMissing: false,\r\n      graphResult: null,\r\n      initialDatasource: datasource,\r\n      history: [],\r\n      latency: 0,\r\n      loading: false,\r\n      logsResult: null,\r\n      queries: ensureQueries(queries),\r\n      queryErrors: [],\r\n      queryHints: [],\r\n      range: range || { ...DEFAULT_RANGE },\r\n      requestOptions: null,\r\n      showingGraph: true,\r\n      showingLogs: true,\r\n      showingTable: true,\r\n      supportsGraph: null,\r\n      supportsLogs: null,\r\n      supportsTable: null,\r\n      tableResult: null,\r\n      ...initialState,\r\n    };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    const { datasourceSrv } = this.props;\r\n    const { initialDatasource } = this.state;\r\n    if (!datasourceSrv) {\r\n      throw new Error('No datasource service passed as props.');\r\n    }\r\n    const datasources = datasourceSrv.getExploreSources();\r\n    if (datasources.length > 0) {\r\n      this.setState({ datasourceLoading: true });\r\n      // Priority: datasource in url, default datasource, first explore datasource\r\n      let datasource;\r\n      if (initialDatasource) {\r\n        datasource = await datasourceSrv.get(initialDatasource);\r\n      } else {\r\n        datasource = await datasourceSrv.get();\r\n      }\r\n      if (!datasource.meta.explore) {\r\n        datasource = await datasourceSrv.get(datasources[0].name);\r\n      }\r\n      this.setDatasource(datasource);\r\n    } else {\r\n      this.setState({ datasourceMissing: true });\r\n    }\r\n  }\r\n\r\n  componentDidCatch(error) {\r\n    this.setState({ datasourceError: error });\r\n    console.error(error);\r\n  }\r\n\r\n  async setDatasource(datasource) {\r\n    const supportsGraph = datasource.meta.metrics;\r\n    const supportsLogs = datasource.meta.logs;\r\n    const supportsTable = datasource.meta.metrics;\r\n    const datasourceId = datasource.meta.id;\r\n    let datasourceError = null;\r\n\r\n    try {\r\n      const testResult = await datasource.testDatasource();\r\n      datasourceError = testResult.status === 'success' ? null : testResult.message;\r\n    } catch (error) {\r\n      datasourceError = (error && error.statusText) || error;\r\n    }\r\n\r\n    const historyKey = `grafana.explore.history.${datasourceId}`;\r\n    const history = store.getObject(historyKey, []);\r\n\r\n    if (datasource.init) {\r\n      datasource.init();\r\n    }\r\n\r\n    // Keep queries but reset edit state\r\n    const nextQueries = this.state.queries.map(q => ({\r\n      ...q,\r\n      edited: false,\r\n    }));\r\n\r\n    this.setState(\r\n      {\r\n        datasource,\r\n        datasourceError,\r\n        history,\r\n        supportsGraph,\r\n        supportsLogs,\r\n        supportsTable,\r\n        datasourceLoading: false,\r\n        queries: nextQueries,\r\n      },\r\n      () => datasourceError === null && this.onSubmit()\r\n    );\r\n  }\r\n\r\n  getRef = el => {\r\n    this.el = el;\r\n  };\r\n\r\n  onAddQueryRow = index => {\r\n    const { queries } = this.state;\r\n    const nextQueries = [\r\n      ...queries.slice(0, index + 1),\r\n      { query: '', key: generateQueryKey() },\r\n      ...queries.slice(index + 1),\r\n    ];\r\n    this.setState({ queries: nextQueries });\r\n  };\r\n\r\n  onChangeDatasource = async option => {\r\n    this.setState({\r\n      datasource: null,\r\n      datasourceError: null,\r\n      datasourceLoading: true,\r\n      graphResult: null,\r\n      latency: 0,\r\n      logsResult: null,\r\n      queryErrors: [],\r\n      queryHints: [],\r\n      tableResult: null,\r\n    });\r\n    const datasource = await this.props.datasourceSrv.get(option.value);\r\n    this.setDatasource(datasource);\r\n  };\r\n\r\n  onChangeQuery = (value: string, index: number, override?: boolean) => {\r\n    const { queries } = this.state;\r\n    let { queryErrors, queryHints } = this.state;\r\n    const prevQuery = queries[index];\r\n    const edited = override ? false : prevQuery.query !== value;\r\n    const nextQuery = {\r\n      ...queries[index],\r\n      edited,\r\n      query: value,\r\n    };\r\n    const nextQueries = [...queries];\r\n    nextQueries[index] = nextQuery;\r\n    if (override) {\r\n      queryErrors = [];\r\n      queryHints = [];\r\n    }\r\n    this.setState(\r\n      {\r\n        queryErrors,\r\n        queryHints,\r\n        queries: nextQueries,\r\n      },\r\n      override ? () => this.onSubmit() : undefined\r\n    );\r\n  };\r\n\r\n  onChangeTime = nextRange => {\r\n    const range = {\r\n      from: nextRange.from,\r\n      to: nextRange.to,\r\n    };\r\n    this.setState({ range }, () => this.onSubmit());\r\n  };\r\n\r\n  onClickClear = () => {\r\n    this.setState({\r\n      graphResult: null,\r\n      logsResult: null,\r\n      latency: 0,\r\n      queries: ensureQueries(),\r\n      queryErrors: [],\r\n      queryHints: [],\r\n      tableResult: null,\r\n    });\r\n  };\r\n\r\n  onClickCloseSplit = () => {\r\n    const { onChangeSplit } = this.props;\r\n    if (onChangeSplit) {\r\n      onChangeSplit(false);\r\n    }\r\n  };\r\n\r\n  onClickGraphButton = () => {\r\n    this.setState(state => ({ showingGraph: !state.showingGraph }));\r\n  };\r\n\r\n  onClickLogsButton = () => {\r\n    this.setState(state => ({ showingLogs: !state.showingLogs }));\r\n  };\r\n\r\n  onClickSplit = () => {\r\n    const { onChangeSplit } = this.props;\r\n    const state = { ...this.state };\r\n    state.queries = state.queries.map(({ edited, ...rest }) => rest);\r\n    if (onChangeSplit) {\r\n      onChangeSplit(true, state);\r\n    }\r\n  };\r\n\r\n  onClickTableButton = () => {\r\n    this.setState(state => ({ showingTable: !state.showingTable }));\r\n  };\r\n\r\n  onClickTableCell = (columnKey: string, rowValue: string) => {\r\n    this.onModifyQueries({ type: 'ADD_FILTER', key: columnKey, value: rowValue });\r\n  };\r\n\r\n  onModifyQueries = (action: object, index?: number) => {\r\n    const { datasource, queries } = this.state;\r\n    if (datasource && datasource.modifyQuery) {\r\n      let nextQueries;\r\n      if (index === undefined) {\r\n        // Modify all queries\r\n        nextQueries = queries.map(q => ({\r\n          ...q,\r\n          edited: false,\r\n          query: datasource.modifyQuery(q.query, action),\r\n        }));\r\n      } else {\r\n        // Modify query only at index\r\n        nextQueries = [\r\n          ...queries.slice(0, index),\r\n          {\r\n            ...queries[index],\r\n            edited: false,\r\n            query: datasource.modifyQuery(queries[index].query, action),\r\n          },\r\n          ...queries.slice(index + 1),\r\n        ];\r\n      }\r\n      this.setState({ queries: nextQueries }, () => this.onSubmit());\r\n    }\r\n  };\r\n\r\n  onRemoveQueryRow = index => {\r\n    const { queries } = this.state;\r\n    if (queries.length <= 1) {\r\n      return;\r\n    }\r\n    const nextQueries = [...queries.slice(0, index), ...queries.slice(index + 1)];\r\n    this.setState({ queries: nextQueries }, () => this.onSubmit());\r\n  };\r\n\r\n  onSubmit = () => {\r\n    const { showingLogs, showingGraph, showingTable, supportsGraph, supportsLogs, supportsTable } = this.state;\r\n    if (showingTable && supportsTable) {\r\n      this.runTableQuery();\r\n    }\r\n    if (showingGraph && supportsGraph) {\r\n      this.runGraphQuery();\r\n    }\r\n    if (showingLogs && supportsLogs) {\r\n      this.runLogsQuery();\r\n    }\r\n  };\r\n\r\n  onQuerySuccess(datasourceId: string, queries: any[]): void {\r\n    // save queries to history\r\n    let { history } = this.state;\r\n    const { datasource } = this.state;\r\n\r\n    if (datasource.meta.id !== datasourceId) {\r\n      // Navigated away, queries did not matter\r\n      return;\r\n    }\r\n\r\n    const ts = Date.now();\r\n    queries.forEach(q => {\r\n      const { query } = q;\r\n      history = [{ query, ts }, ...history];\r\n    });\r\n\r\n    if (history.length > MAX_HISTORY_ITEMS) {\r\n      history = history.slice(0, MAX_HISTORY_ITEMS);\r\n    }\r\n\r\n    // Combine all queries of a datasource type into one history\r\n    const historyKey = `grafana.explore.history.${datasourceId}`;\r\n    store.setObject(historyKey, history);\r\n    this.setState({ history });\r\n  }\r\n\r\n  buildQueryOptions(targetOptions: { format: string; hinting?: boolean; instant?: boolean }) {\r\n    const { datasource, queries, range } = this.state;\r\n    const resolution = this.el.offsetWidth;\r\n    const absoluteRange = {\r\n      from: parseDate(range.from, false),\r\n      to: parseDate(range.to, true),\r\n    };\r\n    const { interval } = kbn.calculateInterval(absoluteRange, resolution, datasource.interval);\r\n    const targets = queries.map(q => ({\r\n      ...targetOptions,\r\n      expr: q.query,\r\n    }));\r\n    return {\r\n      interval,\r\n      range,\r\n      targets,\r\n    };\r\n  }\r\n\r\n  async runGraphQuery() {\r\n    const { datasource, queries } = this.state;\r\n    if (!hasQuery(queries)) {\r\n      return;\r\n    }\r\n    this.setState({ latency: 0, loading: true, graphResult: null, queryErrors: [], queryHints: [] });\r\n    const now = Date.now();\r\n    const options = this.buildQueryOptions({ format: 'time_series', instant: false, hinting: true });\r\n    try {\r\n      const res = await datasource.query(options);\r\n      const result = makeTimeSeriesList(res.data, options);\r\n      const queryHints = res.hints ? makeHints(res.hints) : [];\r\n      const latency = Date.now() - now;\r\n      this.setState({ latency, loading: false, graphResult: result, queryHints, requestOptions: options });\r\n      this.onQuerySuccess(datasource.meta.id, queries);\r\n    } catch (response) {\r\n      console.error(response);\r\n      const queryError = response.data ? response.data.error : response;\r\n      this.setState({ loading: false, queryErrors: [queryError] });\r\n    }\r\n  }\r\n\r\n  async runTableQuery() {\r\n    const { datasource, queries } = this.state;\r\n    if (!hasQuery(queries)) {\r\n      return;\r\n    }\r\n    this.setState({ latency: 0, loading: true, queryErrors: [], queryHints: [], tableResult: null });\r\n    const now = Date.now();\r\n    const options = this.buildQueryOptions({\r\n      format: 'table',\r\n      instant: true,\r\n    });\r\n    try {\r\n      const res = await datasource.query(options);\r\n      const tableModel = res.data[0];\r\n      const latency = Date.now() - now;\r\n      this.setState({ latency, loading: false, tableResult: tableModel, requestOptions: options });\r\n      this.onQuerySuccess(datasource.meta.id, queries);\r\n    } catch (response) {\r\n      console.error(response);\r\n      const queryError = response.data ? response.data.error : response;\r\n      this.setState({ loading: false, queryErrors: [queryError] });\r\n    }\r\n  }\r\n\r\n  async runLogsQuery() {\r\n    const { datasource, queries } = this.state;\r\n    if (!hasQuery(queries)) {\r\n      return;\r\n    }\r\n    this.setState({ latency: 0, loading: true, queryErrors: [], queryHints: [], logsResult: null });\r\n    const now = Date.now();\r\n    const options = this.buildQueryOptions({\r\n      format: 'logs',\r\n    });\r\n\r\n    try {\r\n      const res = await datasource.query(options);\r\n      const logsData = res.data;\r\n      const latency = Date.now() - now;\r\n      this.setState({ latency, loading: false, logsResult: logsData, requestOptions: options });\r\n      this.onQuerySuccess(datasource.meta.id, queries);\r\n    } catch (response) {\r\n      console.error(response);\r\n      const queryError = response.data ? response.data.error : response;\r\n      this.setState({ loading: false, queryErrors: [queryError] });\r\n    }\r\n  }\r\n\r\n  request = url => {\r\n    const { datasource } = this.state;\r\n    return datasource.metadataRequest(url);\r\n  };\r\n\r\n  render() {\r\n    const { datasourceSrv, position, split } = this.props;\r\n    const {\r\n      datasource,\r\n      datasourceError,\r\n      datasourceLoading,\r\n      datasourceMissing,\r\n      graphResult,\r\n      history,\r\n      latency,\r\n      loading,\r\n      logsResult,\r\n      queries,\r\n      queryErrors,\r\n      queryHints,\r\n      range,\r\n      requestOptions,\r\n      showingGraph,\r\n      showingLogs,\r\n      showingTable,\r\n      supportsGraph,\r\n      supportsLogs,\r\n      supportsTable,\r\n      tableResult,\r\n    } = this.state;\r\n    const showingBoth = showingGraph && showingTable;\r\n    const graphHeight = showingBoth ? '200px' : '400px';\r\n    const graphButtonActive = showingBoth || showingGraph ? 'active' : '';\r\n    const logsButtonActive = showingLogs ? 'active' : '';\r\n    const tableButtonActive = showingBoth || showingTable ? 'active' : '';\r\n    const exploreClass = split ? 'explore explore-split' : 'explore';\r\n    const datasources = datasourceSrv.getExploreSources().map(ds => ({\r\n      value: ds.name,\r\n      label: ds.name,\r\n    }));\r\n    const selectedDatasource = datasource ? datasource.name : undefined;\r\n\r\n    return (\r\n      <div className={exploreClass} ref={this.getRef}>\r\n        <div className=\"navbar\">\r\n          {position === 'left' ? (\r\n            <div>\r\n              <a className=\"navbar-page-btn\">\r\n                <i className=\"fa fa-rocket\" />\r\n                Explore\r\n              </a>\r\n            </div>\r\n          ) : (\r\n            <div className=\"navbar-buttons explore-first-button\">\r\n              <button className=\"btn navbar-button\" onClick={this.onClickCloseSplit}>\r\n                Close Split\r\n              </button>\r\n            </div>\r\n          )}\r\n          {!datasourceMissing ? (\r\n            <div className=\"navbar-buttons\">\r\n              <Select\r\n                className=\"datasource-picker\"\r\n                clearable={false}\r\n                onChange={this.onChangeDatasource}\r\n                options={datasources}\r\n                placeholder=\"Loading datasources...\"\r\n                value={selectedDatasource}\r\n              />\r\n            </div>\r\n          ) : null}\r\n          <div className=\"navbar__spacer\" />\r\n          {position === 'left' && !split ? (\r\n            <div className=\"navbar-buttons\">\r\n              <button className=\"btn navbar-button\" onClick={this.onClickSplit}>\r\n                Split\r\n              </button>\r\n            </div>\r\n          ) : null}\r\n          <TimePicker range={range} onChangeTime={this.onChangeTime} />\r\n          <div className=\"navbar-buttons\">\r\n            <button className=\"btn navbar-button navbar-button--no-icon\" onClick={this.onClickClear}>\r\n              Clear All\r\n            </button>\r\n          </div>\r\n          <div className=\"navbar-buttons relative\">\r\n            <button className=\"btn navbar-button--primary\" onClick={this.onSubmit}>\r\n              Run Query <i className=\"fa fa-level-down run-icon\" />\r\n            </button>\r\n            {loading || latency ? <ElapsedTime time={latency} className=\"text-info\" /> : null}\r\n          </div>\r\n        </div>\r\n\r\n        {datasourceLoading ? <div className=\"explore-container\">Loading datasource...</div> : null}\r\n\r\n        {datasourceMissing ? (\r\n          <div className=\"explore-container\">Please add a datasource that supports Explore (e.g., Prometheus).</div>\r\n        ) : null}\r\n\r\n        {datasourceError ? (\r\n          <div className=\"explore-container\">Error connecting to datasource. [{datasourceError}]</div>\r\n        ) : null}\r\n\r\n        {datasource && !datasourceError ? (\r\n          <div className=\"explore-container\">\r\n            <QueryRows\r\n              history={history}\r\n              queries={queries}\r\n              queryErrors={queryErrors}\r\n              queryHints={queryHints}\r\n              request={this.request}\r\n              onAddQueryRow={this.onAddQueryRow}\r\n              onChangeQuery={this.onChangeQuery}\r\n              onClickHintFix={this.onModifyQueries}\r\n              onExecuteQuery={this.onSubmit}\r\n              onRemoveQueryRow={this.onRemoveQueryRow}\r\n            />\r\n            <div className=\"result-options\">\r\n              {supportsGraph ? (\r\n                <button className={`btn navbar-button ${graphButtonActive}`} onClick={this.onClickGraphButton}>\r\n                  Graph\r\n                </button>\r\n              ) : null}\r\n              {supportsTable ? (\r\n                <button className={`btn navbar-button ${tableButtonActive}`} onClick={this.onClickTableButton}>\r\n                  Table\r\n                </button>\r\n              ) : null}\r\n              {supportsLogs ? (\r\n                <button className={`btn navbar-button ${logsButtonActive}`} onClick={this.onClickLogsButton}>\r\n                  Logs\r\n                </button>\r\n              ) : null}\r\n            </div>\r\n\r\n            <main className=\"m-t-2\">\r\n              {supportsGraph && showingGraph ? (\r\n                <Graph\r\n                  data={graphResult}\r\n                  height={graphHeight}\r\n                  loading={loading}\r\n                  id={`explore-graph-${position}`}\r\n                  options={requestOptions}\r\n                  split={split}\r\n                />\r\n              ) : null}\r\n              {supportsTable && showingTable ? (\r\n                <Table className=\"m-t-3\" data={tableResult} loading={loading} onClickCell={this.onClickTableCell} />\r\n              ) : null}\r\n              {supportsLogs && showingLogs ? <Logs data={logsResult} loading={loading} /> : null}\r\n            </main>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default hot(module)(Explore);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport Explore from './Explore';\r\n\r\nexport default class Wrapper extends PureComponent<any, any> {\r\n  state = {\r\n    initialState: null,\r\n    split: false,\r\n  };\r\n\r\n  handleChangeSplit = (split, initialState) => {\r\n    this.setState({ split, initialState });\r\n  };\r\n\r\n  render() {\r\n    // State overrides for props from first Explore\r\n    const { initialState, split } = this.state;\r\n    return (\r\n      <div className=\"explore-wrapper\">\r\n        <Explore {...this.props} position=\"left\" onChangeSplit={this.handleChangeSplit} split={split} />\r\n        {split ? (\r\n          <Explore\r\n            {...this.props}\r\n            initialState={initialState}\r\n            onChangeSplit={this.handleChangeSplit}\r\n            position=\"right\"\r\n            split={split}\r\n          />\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":""}